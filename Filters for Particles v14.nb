(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 12.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[    122410,       2808]
NotebookOptionsPosition[    114229,       2665]
NotebookOutlinePosition[    114720,       2684]
CellTagsIndexPosition[    114677,       2681]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["Initialize", "Section",
 CellChangeTimes->{{3.784892869925601*^9, 
  3.784892893190502*^9}},ExpressionUUID->"6712c0a3-c415-49f1-bcb4-\
37f449375766"],

Cell[BoxData[{
 RowBox[{"ClearAll", "[", "\"\<Global`*\>\"", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"$HistoryLength", "=", "1"}], ";"}], "\[IndentingNewLine]"}], "\n", 
 RowBox[{
  RowBox[{"SetOptions", "[", 
   RowBox[{
    RowBox[{"EvaluationNotebook", "[", "]"}], ",", 
    RowBox[{"CellContext", "\[Rule]", "Notebook"}]}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"$Context", "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"nbd", ":=", 
   RowBox[{"NotebookDirectory", "[", "]"}]}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"packageDirectory", ":=", 
  "\"\<E:\\\\Science\\\\NMI (VTPMML)\\\\MHD Project\\\\Image \
Processing\\\\Mathematica Libraries & Packages\\\\\>\""}], "\
\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Import", "[", 
    RowBox[{"packageDirectory", "<>", "\"\<QuantileRegression.m\>\""}], "]"}],
    ";"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"rawFolder", ":=", 
  "\"\<E:\\\\Science\\\\NMI (VTPMML)\\\\MHD Project\\\\Image \
Processing\\\\HZDR Particles\\\\Images & Videos\\\\Cropped FOV of \
Interest\\\\\>\""}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SetDirectory", "@", "rawFolder"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"rawFiles", "=", 
    RowBox[{"FileNames", "[", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"outputFolder", ":=", 
  RowBox[{"nbd", "<>", "\"\<Output\\\\\>\""}]}], "\n", 
 RowBox[{"filteredFolder", ":=", 
  RowBox[{
  "outputFolder", "<>", "\"\<Filtered\\\\\>\""}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"segmentFolder", ":=", 
   RowBox[{"outputFolder", "<>", "\"\<Segments\\\\\>\""}]}], 
  "\n"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"createFolder", "[", "folder_", "]"}], ":=", 
    RowBox[{"If", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"DirectoryQ", "[", 
       RowBox[{"outputFolder", "<>", "folder"}], "]"}], ",", 
      "\[IndentingNewLine]", "Nothing", ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"outputFolder", "<>", "folder"}], "//", "CreateDirectory"}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"progress", "[", 
    RowBox[{"x_", ",", "y_"}], "]"}], ":=", 
   RowBox[{"TableForm", "@", "\[IndentingNewLine]", 
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{"\"\<Processing...\>\"", ",", "\[IndentingNewLine]", 
      RowBox[{"ProgressIndicator", "@", 
       RowBox[{"Dynamic", "[", 
        RowBox[{
         RowBox[{"x", "/", "y"}], "//", "N"}], "]"}]}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"ToString", "@", 
        RowBox[{"Round", "@", "x"}]}], "<>", "\"\</\>\"", "<>", 
       RowBox[{"ToString", "@", "y"}]}], ",", "\[IndentingNewLine]", 
      RowBox[{"ToString", "@", 
       RowBox[{"PercentForm", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"x", "/", "y"}], "//", "N"}], ",", 
         RowBox[{"DefaultPrintPrecision", "\[Rule]", "1"}]}], "]"}]}]}], 
     "\[IndentingNewLine]", "}"}]}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"view", "[", "image_", "]"}], ":=", 
   RowBox[{"Image", "[", 
    RowBox[{"image", ",", 
     RowBox[{"ImageSize", "\[Rule]", "Large"}]}], "]"}]}], 
  "\n"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"SetOptions", "[", "\[IndentingNewLine]", 
    RowBox[{"Plot", ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Frame", "\[Rule]", "True"}], ",", 
       RowBox[{"LabelStyle", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"Black", ",", "Bold", ",", "fontSize"}], "}"}]}], ",", 
       RowBox[{"GridLines", "\[Rule]", "Automatic"}], ",", 
       RowBox[{"ImageSize", "\[Rule]", "Large"}]}], "}"}]}], 
    "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"SetOptions", "[", "\[IndentingNewLine]", 
    RowBox[{"ListPlot", ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Frame", "\[Rule]", "True"}], ",", 
       RowBox[{"LabelStyle", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"Black", ",", "Bold", ",", "fontSize"}], "}"}]}], ",", 
       RowBox[{"GridLines", "\[Rule]", "Automatic"}], ",", 
       RowBox[{"ImageSize", "\[Rule]", "Large"}]}], "}"}]}], 
    "\[IndentingNewLine]", "]"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"SetOptions", "[", "\[IndentingNewLine]", 
    RowBox[{"ListLinePlot", ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Frame", "\[Rule]", "True"}], ",", 
       RowBox[{"LabelStyle", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"Black", ",", "Bold", ",", "fontSize"}], "}"}]}], ",", 
       RowBox[{"GridLines", "\[Rule]", "Automatic"}], ",", 
       RowBox[{"InterpolationOrder", "\[Rule]", "2"}], ",", 
       RowBox[{"ImageSize", "\[Rule]", "Large"}]}], "}"}]}], 
    "\[IndentingNewLine]", "]"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"SetOptions", "[", "\[IndentingNewLine]", 
    RowBox[{"Histogram", ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Frame", "\[Rule]", "True"}], ",", 
       RowBox[{"GridLines", "\[Rule]", "Automatic"}], ",", 
       RowBox[{"LabelStyle", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"Black", ",", "Bold", ",", "fontSize"}], "}"}]}], ",", 
       RowBox[{"ImageSize", "\[Rule]", "Large"}], ",", 
       RowBox[{"ChartElementFunction", "\[Rule]", "\"\<GlassRectangle\>\""}], 
       ",", 
       RowBox[{"ColorFunction", "\[Rule]", "\"\<GrayTones\>\""}], ",", 
       RowBox[{"LabelingFunction", "\[Rule]", "None"}]}], "}"}]}], 
    "\[IndentingNewLine]", "\[IndentingNewLine]", "]"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"launchNukes", "[", "useKernels_", "]"}], ":=", 
    RowBox[{"If", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"Length", "@", 
        RowBox[{"Kernels", "[", "]"}]}], "<", "useKernels"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Speak", "@", "\"\<Set DEFCON 1\>\""}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"LaunchKernels", "[", "\[IndentingNewLine]", 
        RowBox[{"useKernels", "-", 
         RowBox[{"Length", "@", 
          RowBox[{"Kernels", "[", "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
      ",", "\[IndentingNewLine]", "Nothing"}], "\[IndentingNewLine]", "]"}]}],
    ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"SetSharedVariable", "@", "monitorCounter"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"memoizationSync", "[", "f_Symbol", "]"}], "[", "x_", "]"}], ":=", 
   RowBox[{"With", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"result", "=", 
       RowBox[{"memo", "[", 
        RowBox[{"f", ",", "x"}], "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"result", "===", "Null"}], ",", "\[IndentingNewLine]", 
       RowBox[{"With", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"value", "=", 
           RowBox[{"valueOnMain", "[", 
            RowBox[{"f", ",", "x"}], "]"}]}], "}"}], ",", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"If", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"value", "===", "Null"}], ",", "\[IndentingNewLine]", 
           RowBox[{"f", "/:", 
            RowBox[{"memo", "[", 
             RowBox[{"f", ",", "x"}], "]"}], "=", 
            RowBox[{"setValueOnMain", "[", 
             RowBox[{"f", ",", "x", ",", 
              RowBox[{"f", "[", "x", "]"}]}], "]"}]}], ",", 
           RowBox[{"f", "/:", 
            RowBox[{"memo", "[", 
             RowBox[{"f", ",", "x"}], "]"}], "=", "value"}]}], "]"}]}], 
        "\[IndentingNewLine]", "\[IndentingNewLine]", "]"}], ",", "result"}], 
      "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]"}], "\n", 
 RowBox[{
  RowBox[{"memo", "[", "___", "]"}], ":=", "Null"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DistributeDefinitions", "@", "memo"}], ";"}], 
  "\n"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"valueOnMain", "[", 
    RowBox[{"f_", ",", "x_"}], "]"}], ":=", 
   RowBox[{"memo", "[", 
    RowBox[{"f", ",", "x"}], "]"}]}], "\n"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"setValueOnMain", "[", 
    RowBox[{"f_", ",", "x_", ",", "fx_"}], "]"}], ":=", 
   RowBox[{"f", "/:", 
    RowBox[{"memo", "[", 
     RowBox[{"f", ",", "x"}], "]"}], "=", "fx"}]}], 
  "\n"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SetSharedFunction", "[", 
   RowBox[{"valueOnMain", ",", "setValueOnMain"}], "]"}], 
  "\[IndentingNewLine]"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"clearParallelCache", "[", "f_Symbol", "]"}], ":=", 
   RowBox[{"(", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"UpValues", "@", "f"}], "=", 
      RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"ParallelEvaluate", "[", 
      RowBox[{
       RowBox[{"UpValues", "@", "f"}], "=", 
       RowBox[{"{", "}"}]}], "]"}], ";"}], "\[IndentingNewLine]", ")"}]}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"view", "[", "image_", "]"}], ":=", 
   RowBox[{
    RowBox[{
     RowBox[{"Image", "[", 
      RowBox[{"#", ",", 
       RowBox[{"ImageSize", "\[Rule]", "Large"}]}], "]"}], "&"}], "@", 
    "image"}]}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"If", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"DirectoryQ", "@", "outputFolder"}], ",", "\[IndentingNewLine]", 
    "Nothing", ",", "\[IndentingNewLine]", 
    RowBox[{"CreateDirectory", "@", "outputFolder"}]}], "\[IndentingNewLine]",
    "]"}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.7845554666992693`*^9, 3.784555538984022*^9}, {
   3.784555569476314*^9, 3.784555637416831*^9}, 3.784555931068453*^9, 
   3.784556127387751*^9, {3.7845572149336767`*^9, 3.7845572153556337`*^9}, {
   3.7845573851192408`*^9, 3.7845573872544765`*^9}, {3.784558210562722*^9, 
   3.7845582110000687`*^9}, {3.784558472160023*^9, 3.7845584868704395`*^9}, 
   3.784558570862454*^9, 3.784558905549432*^9, {3.7846195609737263`*^9, 
   3.784619569905192*^9}, {3.7848898919923186`*^9, 3.7848899197821856`*^9}, {
   3.784892900916186*^9, 3.7848929622990646`*^9}, {3.7848929928828783`*^9, 
   3.7848929932558827`*^9}, {3.7848947696908045`*^9, 
   3.7848947799386477`*^9}, {3.8026906481521063`*^9, 3.802690695946686*^9}, {
   3.802690911253878*^9, 3.802690933967896*^9}, 3.802691960445137*^9, {
   3.802693408482444*^9, 3.802693422334919*^9}, {3.8026935299226913`*^9, 
   3.802693536958362*^9}, {3.8027114707438526`*^9, 3.8027115055210414`*^9}, {
   3.802711564695506*^9, 3.8027115655110054`*^9}, {3.815134889124729*^9, 
   3.815134907573181*^9}, {3.815237657582016*^9, 3.8152376913507605`*^9}, {
   3.815239986534052*^9, 3.8152399873050303`*^9}, {3.8152400234856606`*^9, 
   3.8152400264264784`*^9}, 3.8152407381180944`*^9, 3.815282830882036*^9, 
   3.815312594853924*^9, {3.8153187139765663`*^9, 3.815318717360011*^9}, {
   3.815321394527096*^9, 3.8153214417264977`*^9}, {3.815321578225099*^9, 
   3.8153215847378745`*^9}, {3.8153220692682714`*^9, 3.815322074916122*^9}, {
   3.8160799972400937`*^9, 3.8160800066400385`*^9}, {3.8161717973400025`*^9, 
   3.8161718054995623`*^9}, 3.816196637846551*^9, 3.8161970660461836`*^9, 
   3.820227545000471*^9, 3.820231703860345*^9, 3.8223953825292788`*^9, 
   3.833336950440164*^9, {3.8333369953384314`*^9, 3.8333369975222178`*^9}, {
   3.833363351662812*^9, 3.8333633527200384`*^9}, 3.8334506790035906`*^9, 
   3.833599693155428*^9, {3.8336125513359256`*^9, 3.83361255206398*^9}, {
   3.833633888357044*^9, 3.833633895430142*^9}, {3.833649073831299*^9, 
   3.833649074113494*^9}, {3.833694133457445*^9, 3.8336941438585644`*^9}, {
   3.8337948760679655`*^9, 3.8337948783807745`*^9}, 3.833795757109977*^9, 
   3.8338919927774057`*^9, 3.833892099200822*^9, 3.8339041036301427`*^9, {
   3.834552443176361*^9, 3.834552444352207*^9}, {3.834553666474509*^9, 
   3.8345536679782066`*^9}, 3.8368837372216263`*^9, 3.836883845300471*^9, 
   3.8369742539607935`*^9, {3.836988608443217*^9, 3.836988622594178*^9}, {
   3.8369886879234266`*^9, 3.836988690124406*^9}},
 CellLabel->"In[1]:=",ExpressionUUID->"33230b11-4249-4515-99fe-7cc4a266cb25"],

Cell[CellGroupData[{

Cell[">> Import Images <<", "Subsection",
 CellChangeTimes->{{3.7845554666992693`*^9, 3.784555538984022*^9}, {
   3.784555569476314*^9, 3.784555637416831*^9}, 3.784555931068453*^9, 
   3.784556127387751*^9, {3.7845572149336767`*^9, 3.7845572153556337`*^9}, {
   3.7845573851192408`*^9, 3.7845573872544765`*^9}, {3.784558210562722*^9, 
   3.7845582110000687`*^9}, {3.784558472160023*^9, 3.7845584868704395`*^9}, 
   3.784558570862454*^9, 3.784558905549432*^9, {3.7846195609737263`*^9, 
   3.784619569905192*^9}, {3.7848898919923186`*^9, 3.7848899197821856`*^9}, {
   3.784892900916186*^9, 3.7848930065283146`*^9}, {3.836989922225605*^9, 
   3.836989924001814*^9}},ExpressionUUID->"9613a0cf-e9a0-4762-9d69-\
90d01789c1b9"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"useKernels", "=", 
   RowBox[{"2", "*", "$ProcessorCount"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"launchNukes", "@", "useKernels"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"images", "=", 
   RowBox[{"ParallelMap", "[", "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"Import", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"rawFolder", "<>", "#"}], ",", "\[IndentingNewLine]", 
        RowBox[{"IncludeMetaInformation", "\[Rule]", "None"}]}], 
       "\[IndentingNewLine]", "]"}], "&"}], ",", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"rawFiles", "[", 
      RowBox[{"[", 
       RowBox[{"1", ";;", 
        RowBox[{"Length", "@", "rawFiles"}]}], "]"}], "]"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.784558500179827*^9, 3.7845585482195983`*^9}, {
  3.784893010665941*^9, 3.7848930124565725`*^9}, {3.815236610177719*^9, 
  3.8152366240219917`*^9}, {3.8152400313333406`*^9, 3.8152400579023447`*^9}, {
  3.815240739784361*^9, 3.81524075110955*^9}, {3.815241173693971*^9, 
  3.8152411738404846`*^9}, {3.8152413257152824`*^9, 3.8152413260035105`*^9}, {
  3.816197790269805*^9, 3.8161977915313096`*^9}, {3.82023184663017*^9, 
  3.820231847098916*^9}, {3.833337175439787*^9, 3.8333372062107763`*^9}, {
  3.8333372829463425`*^9, 3.833337284013678*^9}, {3.8333373292126637`*^9, 
  3.833337338015465*^9}, {3.833599713029393*^9, 3.8335997144858665`*^9}, {
  3.83361712372564*^9, 3.83361712551785*^9}, {3.8459009532691946`*^9, 
  3.8459009886835403`*^9}},
 CellLabel->"In[32]:=",ExpressionUUID->"2517dd0c-e81e-49d7-be8f-dfc90a561b88"]
}, Open  ]],

Cell[CellGroupData[{

Cell["[[ View Imported Images ]]", "Subsection",
 CellChangeTimes->{{3.7845554666992693`*^9, 3.784555538984022*^9}, {
   3.784555569476314*^9, 3.784555637416831*^9}, 3.784555931068453*^9, 
   3.784556127387751*^9, {3.7845572149336767`*^9, 3.7845572153556337`*^9}, {
   3.7845573851192408`*^9, 3.7845573872544765`*^9}, {3.784558210562722*^9, 
   3.7845582110000687`*^9}, {3.784558472160023*^9, 3.7845584868704395`*^9}, 
   3.784558570862454*^9, 3.784558905549432*^9, {3.7846195609737263`*^9, 
   3.784619569905192*^9}, {3.7848898919923186`*^9, 3.7848899197821856`*^9}, {
   3.784892900916186*^9, 3.784893026497746*^9}, {3.836989926210137*^9, 
   3.8369899278262563`*^9}},ExpressionUUID->"f3dfa33c-689a-474f-a224-\
406533410d92"],

Cell[BoxData[
 RowBox[{"Manipulate", "[", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"view", "@", 
    RowBox[{"images", "[", 
     RowBox[{"[", "k", "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
   RowBox[{"{", 
    RowBox[{"k", ",", "1", ",", 
     RowBox[{"Length", "@", "images"}], ",", "1"}], "}"}]}], 
  "\[IndentingNewLine]", "]"}]], "Input",
 CellChangeTimes->{{3.7845586033588924`*^9, 3.7845586330811667`*^9}, {
   3.7845589354746437`*^9, 3.7845589368497963`*^9}, {3.8151348380964546`*^9, 
   3.8151348383906593`*^9}, 3.8151348729688168`*^9, {3.8151349326473866`*^9, 
   3.81513498334923*^9}, {3.815137422449659*^9, 3.815137423280405*^9}, {
   3.8152366294649734`*^9, 3.8152366574710855`*^9}},
 CellLabel->"In[35]:=",ExpressionUUID->"edde4f0a-9198-48eb-8468-d2fe5c7a3673"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Remove The Mean Field Artefacts", "Subsection",
 CellChangeTimes->{{3.7845554666992693`*^9, 3.784555538984022*^9}, {
   3.784555569476314*^9, 3.784555637416831*^9}, 3.784555931068453*^9, 
   3.784556127387751*^9, {3.7845572149336767`*^9, 3.7845572153556337`*^9}, {
   3.7845573851192408`*^9, 3.7845573872544765`*^9}, {3.784558210562722*^9, 
   3.7845582110000687`*^9}, {3.784558472160023*^9, 3.7845584868704395`*^9}, 
   3.784558570862454*^9, 3.784558905549432*^9, {3.7846195609737263`*^9, 
   3.784619569905192*^9}, {3.7848898919923186`*^9, 3.7848899197821856`*^9}, {
   3.784892900916186*^9, 3.784893026497746*^9}, {3.83389327006611*^9, 
   3.8338932801870484`*^9}},ExpressionUUID->"b0157643-4a6b-4e49-ad69-\
778df8958543"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"meanField", "=", 
   RowBox[{"ColorNegate", "@", 
    RowBox[{"Mean", "@", "images"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"meanField", "//", "Colorize"}]}], "Input",
 CellChangeTimes->{{3.8338922393474407`*^9, 3.833892241785799*^9}, {
   3.833892330802532*^9, 3.833892336052955*^9}, {3.8338925535311475`*^9, 
   3.833892553594977*^9}, {3.8338928867393527`*^9, 3.8338929114532824`*^9}, 
   3.8338930458993683`*^9, {3.8338932858349495`*^9, 3.8338933454027014`*^9}, {
   3.83389342090685*^9, 3.833893453979435*^9}, {3.8338937117552986`*^9, 
   3.83389372702747*^9}, {3.8339043350906224`*^9, 3.8339043419862328`*^9}, {
   3.8368840089486113`*^9, 3.8368840221478357`*^9}, {3.8459011519585323`*^9, 
   3.8459011538519087`*^9}},
 CellLabel->"In[36]:=",ExpressionUUID->"9e02d763-462d-43e7-92cc-59f42fb63101"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"dilationScale", "=", "2"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"sizeThreshold", "=", "2"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"otsuThreshold", "=", "0.625"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"getArtefacts", "[", "image_", "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"Dilation", "[", 
         RowBox[{"#", ",", 
          RowBox[{"DiskMatrix", "@", "dilationScale"}]}], "]"}], "&"}], "@", 
       "\[IndentingNewLine]", 
       RowBox[{"DeleteSmallComponents", "[", 
        RowBox[{"#", ",", "sizeThreshold"}], "]"}]}], "&"}], "@", 
     "\[IndentingNewLine]", 
     RowBox[{"DeleteBorderComponents", "@", 
      RowBox[{"Binarize", "[", 
       RowBox[{"#", ",", "otsuThreshold"}], "]"}]}]}], "&"}], "@", 
   "image"}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.8445201085531826`*^9, 3.8445201218715916`*^9}, {
  3.8445206641125712`*^9, 3.844520703912198*^9}},
 CellLabel->"In[38]:=",ExpressionUUID->"e313a4df-6f8e-4f9e-a20f-0c531a4c9605"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"artefactMask", "=", 
    RowBox[{"getArtefacts", "@", "meanField"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"testID", "=", "1"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"viewMask", "=", 
   RowBox[{"HighlightImage", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Colorize", "@", 
      RowBox[{"images", "[", 
       RowBox[{"[", "testID", "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"Style", "[", 
        RowBox[{"#", ",", "White"}], "]"}], "&"}], "@", "artefactMask"}]}], 
    "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"corrected", "=", 
   RowBox[{"Inpaint", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"images", "[", 
      RowBox[{"[", "testID", "]"}], "]"}], ",", "\[IndentingNewLine]", 
     "artefactMask", ",", 
     RowBox[{"Method", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{"\"\<TextureSynthesis\>\"", ",", 
        RowBox[{"\"\<MaxSamples\>\"", "\[Rule]", "100"}]}], "}"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.8338922393474407`*^9, 3.833892241785799*^9}, {
   3.833892330802532*^9, 3.833892336052955*^9}, {3.8338925535311475`*^9, 
   3.833892553594977*^9}, {3.8338928867393527`*^9, 3.8338929114532824`*^9}, 
   3.8338930458993683`*^9, {3.8338932858349495`*^9, 3.8338933454027014`*^9}, {
   3.83389342090685*^9, 3.833893453979435*^9}, {3.8338937117552986`*^9, 
   3.83389372702747*^9}, {3.8339043350906224`*^9, 3.8339043419862328`*^9}, {
   3.8368840089486113`*^9, 3.8368840221478357`*^9}, {3.8459011519585323`*^9, 
   3.8459011538519087`*^9}, 3.8459011936206865`*^9},
 CellLabel->"In[42]:=",ExpressionUUID->"d7e4f08d-416c-48fd-9aa6-0849b48c0eea"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"cleanImages", "=", 
     RowBox[{"ParallelMap", "[", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"Inpaint", "[", "\[IndentingNewLine]", 
         RowBox[{"#", ",", "artefactMask", ",", "\[IndentingNewLine]", 
          RowBox[{"Method", "\[Rule]", 
           RowBox[{"{", 
            RowBox[{"\"\<TextureSynthesis\>\"", ",", 
             RowBox[{"\"\<MaxSamples\>\"", "\[Rule]", "100"}]}], "}"}]}]}], 
         "\[IndentingNewLine]", "]"}], "&"}], ",", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", "images"}], "\[IndentingNewLine]", "]"}]}], 
    ";"}], "//", "AbsoluteTiming"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"cleanMeanField", "=", 
   RowBox[{"ColorNegate", "@", 
    RowBox[{"Mean", "@", "cleanImages"}]}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.833892946267211*^9, 3.8338929865874195`*^9}, {
  3.833893481074997*^9, 3.8338934822747893`*^9}, {3.833893551098796*^9, 
  3.8338935612666135`*^9}, {3.833893836763104*^9, 3.833893839522727*^9}, {
  3.8339044536643867`*^9, 3.833904469053319*^9}},
 CellLabel->"In[46]:=",ExpressionUUID->"8560e631-1902-499c-9087-a63888e3e317"],

Cell[BoxData[
 RowBox[{"GraphicsGrid", "[", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"{", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Colorize", "@", "meanField"}], ",", "\[IndentingNewLine]", 
       RowBox[{"Colorize", "@", "cleanMeanField"}]}], "\[IndentingNewLine]", 
      "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"{", "\[IndentingNewLine]", 
      RowBox[{"viewMask", ",", "\[IndentingNewLine]", 
       RowBox[{"Colorize", "@", "corrected"}]}], "}"}]}], 
    "\[IndentingNewLine]", "}"}], ",", 
   RowBox[{"Dividers", "\[Rule]", "All"}], ",", 
   RowBox[{"ImageSize", "\[Rule]", "Full"}]}], "\[IndentingNewLine]", 
  "]"}]], "Input",
 CellChangeTimes->{{3.833893512619667*^9, 3.833893703403626*^9}, {
  3.833893733799368*^9, 3.833893735049026*^9}},
 CellLabel->"In[48]:=",ExpressionUUID->"f7060faf-147b-4d69-93f4-2aa20d149188"]
}, Open  ]],

Cell[CellGroupData[{

Cell["[[ View The Clean Images ]]", "Subsection",
 CellChangeTimes->{{3.7845554666992693`*^9, 3.784555538984022*^9}, {
   3.784555569476314*^9, 3.784555637416831*^9}, 3.784555931068453*^9, 
   3.784556127387751*^9, {3.7845572149336767`*^9, 3.7845572153556337`*^9}, {
   3.7845573851192408`*^9, 3.7845573872544765`*^9}, {3.784558210562722*^9, 
   3.7845582110000687`*^9}, {3.784558472160023*^9, 3.7845584868704395`*^9}, 
   3.784558570862454*^9, 3.784558905549432*^9, {3.7846195609737263`*^9, 
   3.784619569905192*^9}, {3.7848898919923186`*^9, 3.7848899197821856`*^9}, {
   3.784892900916186*^9, 3.784893026497746*^9}, {3.83389327006611*^9, 
   3.8338932801870484`*^9}, {3.8338937788908195`*^9, 
   3.8338937811068954`*^9}, {3.833893829018809*^9, 3.833893829338952*^9}, {
   3.8369899430026865`*^9, 
   3.8369899446340303`*^9}},ExpressionUUID->"12fdf088-b5f8-4e0e-af3a-\
8328a9757651"],

Cell[BoxData[
 RowBox[{"Manipulate", "[", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"view", "@", 
    RowBox[{"cleanImages", "[", 
     RowBox[{"[", "k", "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
   RowBox[{"{", 
    RowBox[{"k", ",", "1", ",", 
     RowBox[{"Length", "@", "images"}], ",", "1"}], "}"}]}], 
  "\[IndentingNewLine]", "]"}]], "Input",
 CellChangeTimes->{{3.8338931106353035`*^9, 3.8338931115159497`*^9}},
 CellLabel->"In[49]:=",ExpressionUUID->"3dfeb144-73d9-4329-a185-7dde7922778d"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Detect particles", "Section",
 CellChangeTimes->{{3.8333640993918285`*^9, 
  3.8333641079015636`*^9}},ExpressionUUID->"087dd570-4e5e-4c06-994a-\
9ae95ddf2b3f"],

Cell[CellGroupData[{

Cell["Filtering & Segmentation", "Subsection",
 CellChangeTimes->{{3.802684240578278*^9, 3.8026842493824778`*^9}, {
   3.8026846810256166`*^9, 3.8026846892735386`*^9}, {3.815293730992757*^9, 
   3.815293732210492*^9}, {3.8153201243377657`*^9, 3.8153201288422775`*^9}, {
   3.816195718117414*^9, 3.816195741053176*^9}, 
   3.8333445526604733`*^9},ExpressionUUID->"c541d18d-ded8-44ab-9450-\
60634f170e8d"],

Cell["\<\
Defaults :
   
nonlocalCorrectionWeight=1.5;
nonlocalCorrectionRadius=1;
luminanceCompression=0.65;
nonlocalNoiseFactor=0.5;
nonlocalFilterRadius=2;
nonlocalFilterReach=10;
meanFilterRadius=2;
adaptiveThresholdRadius=10;\
\>", "Abstract",
 CellChangeTimes->{{3.8336126894893217`*^9, 3.8336127027264314`*^9}, 
   3.8336129815881867`*^9},
 FontSize->16,ExpressionUUID->"b49caba2-1040-43f7-9729-416190f7f017"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"nonlocalCorrectionWeight", "=", "1.5"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"nonlocalCorrectionRadius", "=", "1"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"luminanceCompression", "=", "0.65"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"nonlocalNoiseFactor", "=", "0.5"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"nonlocalFilterRadius", "=", "2"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"nonlocalFilterReach", "=", "10"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"meanFilterRadius", "=", "2"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"adaptiveThresholdRadius", "=", "10"}], ";"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"localImage", "[", "image_", "]"}], ":=", 
   RowBox[{"ImageAdjust", "@", 
    RowBox[{"ColorNegate", "@", "image"}]}]}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"correction", "[", "image_", "]"}], ":=", 
   RowBox[{
    RowBox[{
     RowBox[{"ImageAdjust", "@", 
      RowBox[{"ImageMultiply", "[", "\[IndentingNewLine]", 
       RowBox[{"#", ",", 
        RowBox[{"#", "-", 
         RowBox[{"ColorNegate", "@", 
          RowBox[{"ColorToneMapping", "[", "\[IndentingNewLine]", 
           RowBox[{"#", ",", "luminanceCompression", ",", 
            RowBox[{"Method", "\[Rule]", "\"\<Luminance\>\""}]}], 
           "\[IndentingNewLine]", "]"}]}]}]}], "\[IndentingNewLine]", "]"}]}],
      "&"}], "@", "image"}]}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"nonlocalCorrection", "[", "image_", "]"}], ":=", 
   RowBox[{
    RowBox[{
     RowBox[{"2", "*", "image"}], "-", 
     RowBox[{"nonlocalCorrectionWeight", "*", 
      RowBox[{"NonlocalMeansFilter", "[", "\[IndentingNewLine]", 
       RowBox[{
       "image", ",", "nonlocalCorrectionRadius", ",", "nonlocalNoiseFactor"}],
        "\[IndentingNewLine]", "]"}]}]}], "//", "ImageAdjust"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"nonlocalFiltered", "[", "image_", "]"}], ":=", 
   RowBox[{
    RowBox[{"NonlocalMeansFilter", "[", 
     RowBox[{
     "image", ",", "nonlocalFilterRadius", ",", "Automatic", ",", 
      "nonlocalFilterReach"}], "]"}], "//", "ImageAdjust"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"meanFilter", "[", "image_", "]"}], ":=", 
   RowBox[{
    RowBox[{"MeanFilter", "[", 
     RowBox[{"image", ",", "meanFilterRadius"}], "]"}], "//", 
    "ImageAdjust"}]}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"localSegmentation", "[", "image_", "]"}], ":=", 
   RowBox[{"DeleteBorderComponents", "@", 
    RowBox[{"LocalAdaptiveBinarize", "[", 
     RowBox[{
      RowBox[{"correction", "@", "image"}], ",", "adaptiveThresholdRadius"}], 
     "]"}]}]}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"filteredRegion", "[", "image_", "]"}], ":=", 
   RowBox[{"meanFilter", "@", 
    RowBox[{"nonlocalFiltered", "@", 
     RowBox[{"correction", "@", 
      RowBox[{"nonlocalCorrection", "@", 
       RowBox[{"localImage", "[", "image", "]"}]}]}]}]}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"segmentedRegion", "[", "image_", "]"}], ":=", 
  RowBox[{"localSegmentation", "@", 
   RowBox[{"filteredRegion", "[", "image", "]"}]}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.8152928701385374`*^9, 3.8152929095154223`*^9}, {
   3.815293203100834*^9, 3.8152932044252834`*^9}, {3.8152985915999465`*^9, 
   3.815298592711982*^9}, {3.8152991651625996`*^9, 3.815299165246368*^9}, 
   3.8153004254453*^9, 3.8153009423101015`*^9, 3.815301467391207*^9, {
   3.8153024734657407`*^9, 3.815302473527557*^9}, 3.8153058689692507`*^9, 
   3.8153061799079037`*^9, 3.815306979816579*^9, {3.8153198102442603`*^9, 
   3.815319820259759*^9}, {3.815320423702215*^9, 3.815320430021192*^9}, {
   3.8161004329154563`*^9, 3.816100447325368*^9}, {3.816193512329442*^9, 
   3.8161935221296062`*^9}, {3.8161936372647877`*^9, 
   3.8161936650790825`*^9}, {3.816193746912405*^9, 3.816193759839574*^9}, {
   3.8161965226458163`*^9, 3.8161965302297077`*^9}, {3.8333446031900454`*^9, 
   3.833344622515641*^9}, {3.8333477657667913`*^9, 3.8333478038209476`*^9}, {
   3.8333478388130074`*^9, 3.833347841543011*^9}, 3.833461104908938*^9, {
   3.8334675243859324`*^9, 3.8334675287574058`*^9}, {3.8334677176114845`*^9, 
   3.8334677247410355`*^9}},
 CellLabel->"In[50]:=",ExpressionUUID->"d794ac8d-786b-4679-869d-65f64ebb26f1"]
}, Open  ]],

Cell[CellGroupData[{

Cell["[[ Test Interrogation Window (IW) Filtering ]]", "Subsection",
 CellChangeTimes->{{3.802684240578278*^9, 3.8026842493824778`*^9}, {
   3.8026846810256166`*^9, 3.8026846892735386`*^9}, {3.815293730992757*^9, 
   3.815293732210492*^9}, {3.8153201243377657`*^9, 3.8153201288422775`*^9}, {
   3.816195718117414*^9, 3.816195741053176*^9}, 3.8333445526604733`*^9, {
   3.833364124390366*^9, 3.833364150437972*^9}, {3.833448866308405*^9, 
   3.833448871023754*^9}, {3.836884314244477*^9, 
   3.836884321116076*^9}},ExpressionUUID->"dc1c4721-1dcf-4cba-85b6-\
ce9411393e87"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"testID", "=", "645"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"view", "@", 
  RowBox[{"images", "[", 
   RowBox[{"[", "testID", "]"}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"images", "[", 
    RowBox[{"[", "testID", "]"}], "]"}], "//", "ImageDimensions"}], 
  "\n"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"windowSize", "=", "60"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"offsetX", "=", "300"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"offsetY", "=", "45"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"window", "=", 
    RowBox[{"ImageTake", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"images", "[", 
       RowBox[{"[", "testID", "]"}], "]"}], ",", "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"1", "+", " ", "offsetY"}], ",", 
        RowBox[{"windowSize", "+", "offsetY"}]}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"1", "+", "offsetX"}], ",", 
        RowBox[{"windowSize", "+", "offsetX"}]}], "}"}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"GraphicsRow", "[", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"{", 
      RowBox[{"window", ",", 
       RowBox[{"Colorize", "@", 
        RowBox[{"filteredRegion", "@", "#"}]}], ",", 
       RowBox[{"segmentedRegion", "@", "#"}]}], "}"}], "&"}], "@", "window"}],
    ",", "\[IndentingNewLine]", 
   RowBox[{"ImageSize", "\[Rule]", "Large"}], ",", 
   RowBox[{"Dividers", "\[Rule]", "All"}]}], "\[IndentingNewLine]", 
  "]"}]}], "Input",
 CellChangeTimes->{{3.8333374391409235`*^9, 3.833337443323549*^9}, {
  3.833347979964803*^9, 3.8333479811765637`*^9}, {3.8333619938985033`*^9, 
  3.833362011739244*^9}, {3.833443902949181*^9, 3.833443928444646*^9}, {
  3.8334610950068274`*^9, 3.833461095341406*^9}, {3.8334627263672185`*^9, 
  3.8334627313224754`*^9}, {3.8335997762221694`*^9, 3.833599824414296*^9}},
 CellLabel->"In[66]:=",ExpressionUUID->"599c87bb-e197-4b5c-9b12-019968b6d00e"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Generate IWs", "Subsection",
 CellChangeTimes->{{3.802684240578278*^9, 3.8026842493824778`*^9}, {
   3.8026846810256166`*^9, 3.8026846892735386`*^9}, {3.815293730992757*^9, 
   3.815293732210492*^9}, {3.8153201243377657`*^9, 3.8153201288422775`*^9}, {
   3.816195718117414*^9, 3.816195741053176*^9}, 3.8333445526604733`*^9, {
   3.833364124390366*^9, 
   3.833364174670321*^9}},ExpressionUUID->"75760629-112e-453c-82f4-\
280acb90a956"],

Cell["\<\
Defaults :
   
windowSize = 50;
offsetX = 10;
offsetY = 10;\
\>", "Abstract",
 CellChangeTimes->{{3.8336126894893217`*^9, 3.8336127027264314`*^9}},
 FontSize->16,ExpressionUUID->"e855621a-f2ac-4045-a6b5-994536e5d351"],

Cell[BoxData[
 RowBox[{
  RowBox[{"images", "=", "cleanImages"}], ";"}]], "Input",
 CellChangeTimes->{{3.833904524758204*^9, 3.8339045344652367`*^9}},
 CellLabel->"In[79]:=",ExpressionUUID->"d54cbfdb-f95a-4d83-9e67-ed281b69a3ee"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"truePosition", "[", "windowCentroid_", "]"}], ":=", 
   RowBox[{
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"First", "@", "#"}], ",", 
       RowBox[{
        RowBox[{"Last", "@", 
         RowBox[{"ImageDimensions", "@", 
          RowBox[{"First", "@", "images"}]}]}], "-", 
        RowBox[{"Last", "@", "#"}]}]}], "}"}], "&"}], "@", 
    RowBox[{"Reverse", "@", "windowCentroid"}]}]}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"windowSize", "=", "50"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"offsetX", "=", "10"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"offsetY", "=", "10"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"backgroundBias", "=", 
   RowBox[{"10", "^", 
    RowBox[{"-", "6"}]}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.8333598889565134`*^9, 3.8333598991160946`*^9}, {
   3.8333599667655544`*^9, 3.833359967956083*^9}, {3.8333600195665493`*^9, 
   3.833360068877907*^9}, {3.833360117415926*^9, 3.833360264978052*^9}, {
   3.8333603017027283`*^9, 3.8333603100630608`*^9}, 3.8333604765802536`*^9, 
   3.833360858102317*^9, 3.8333611418185005`*^9, {3.8333612780805964`*^9, 
   3.8333613559604435`*^9}, {3.833361970373638*^9, 3.8333619768955708`*^9}, 
   3.8333622112272167`*^9, {3.8334373114300814`*^9, 3.8334373163927965`*^9}, {
   3.833437381726755*^9, 3.8334374920306807`*^9}, {3.83343752920436*^9, 
   3.8334375973548403`*^9}, 3.8334440152527323`*^9, {3.8334440469459076`*^9, 
   3.8334440473115788`*^9}, 3.833444083211836*^9, {3.833511351876427*^9, 
   3.833511354126651*^9}, 3.833511386958818*^9, {3.8336127601991897`*^9, 
   3.8336127616792693`*^9}, {3.833612817919905*^9, 3.833612821407547*^9}, {
   3.8336128617196836`*^9, 3.8336128635827484`*^9}, {3.833615520236326*^9, 
   3.833615543171036*^9}, {3.8336155776349344`*^9, 3.833615578370968*^9}, {
   3.833615684363638*^9, 3.8336156866667614`*^9}, {3.8336158962680087`*^9, 
   3.833615902601505*^9}, 3.8336160680591803`*^9, {3.8339045214221935`*^9, 
   3.8339045226090083`*^9}},
 CellLabel->"In[74]:=",ExpressionUUID->"c3037abd-5f02-48e9-8f16-70e29aec921b"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"scanStepsX", "=", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"-", "windowSize"}], "/", "offsetX"}], "+", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"First", "@", 
         RowBox[{"ImageDimensions", "@", 
          RowBox[{"First", "@", "images"}]}]}], "/", "offsetX"}]}], "//", 
      "N"}], "//", "Round"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"scanStepsY", "=", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"-", "windowSize"}], "/", "offsetY"}], "+", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Last", "@", 
         RowBox[{"ImageDimensions", "@", 
          RowBox[{"First", "@", "images"}]}]}], "/", "offsetY"}]}], "//", 
      "N"}], "//", "Round"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"windowBounds", "=", 
    RowBox[{
     RowBox[{
      RowBox[{"Flatten", "[", 
       RowBox[{"#", ",", "1"}], "]"}], "&"}], "@", 
     RowBox[{"Table", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"1", "+", 
            RowBox[{"k", "*", " ", "offsetY"}]}], ",", 
           RowBox[{"windowSize", "+", 
            RowBox[{"k", "*", "offsetY"}]}]}], "}"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"1", "+", 
            RowBox[{"m", "*", "offsetX"}]}], ",", 
           RowBox[{"windowSize", "+", 
            RowBox[{"m", "*", "offsetX"}]}]}], "}"}]}], "\[IndentingNewLine]",
         "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"k", ",", "0", ",", "scanStepsY"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"m", ",", "0", ",", "scanStepsX"}], "}"}]}], 
      "\[IndentingNewLine]", "]"}]}]}], ";"}], "\n"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"windowLocations", "=", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{"Mean", "/@", "#"}], ")"}], "&"}], "/@", "windowBounds"}], "//",
      "N"}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"trueWindowLocations", "=", 
    RowBox[{"truePosition", "/@", "windowLocations"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"{", 
  RowBox[{
   RowBox[{"scanStepsX", "+", "1"}], ",", 
   RowBox[{"scanStepsY", "+", "1"}], ",", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{"scanStepsX", "+", "1"}], ")"}], "*", 
    RowBox[{"(", 
     RowBox[{"scanStepsY", "+", "1"}], ")"}]}]}], "}"}]}], "Input",
 CellChangeTimes->{{3.8336159061153593`*^9, 3.83361593850801*^9}, {
  3.8336274819404163`*^9, 3.833627495949977*^9}},
 CellLabel->"In[80]:=",ExpressionUUID->"743f18b6-b082-484c-a1df-766d6ea95df0"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"interrogationWindows", "=", 
    RowBox[{"Table", "[", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"ImageTake", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"images", "[", 
           RowBox[{"[", "k", "]"}], "]"}], ",", 
          RowBox[{"First", "@", "#"}], ",", 
          RowBox[{"Last", "@", "#"}]}], "\[IndentingNewLine]", "]"}], "&"}], "/@",
        "windowBounds"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{"k", ",", "1", ",", 
        RowBox[{"Length", "@", "images"}]}], "}"}]}], "\[IndentingNewLine]", 
     "]"}]}], ";"}], "//", "AbsoluteTiming"}]], "Input",
 CellChangeTimes->{{3.8333598889565134`*^9, 3.8333598991160946`*^9}, {
   3.8333599667655544`*^9, 3.833359967956083*^9}, {3.8333600195665493`*^9, 
   3.833360068877907*^9}, {3.833360117415926*^9, 3.833360264978052*^9}, {
   3.8333603017027283`*^9, 3.8333603100630608`*^9}, 3.8333604765802536`*^9, 
   3.833360858102317*^9, 3.8333611418185005`*^9, {3.8333612780805964`*^9, 
   3.8333613559604435`*^9}, {3.833361970373638*^9, 3.8333619768955708`*^9}, 
   3.8333622112272167`*^9, {3.8334373114300814`*^9, 3.8334373163927965`*^9}, {
   3.833437381726755*^9, 3.8334374920306807`*^9}, {3.83343752920436*^9, 
   3.8334375973548403`*^9}, {3.8334440152527323`*^9, 
   3.8334440257048097`*^9}, {3.833444452716629*^9, 3.8334444538152356`*^9}, {
   3.8334617381015587`*^9, 3.8334617392893333`*^9}, {3.833511344624629*^9, 
   3.8335113498965187`*^9}, {3.833511415564149*^9, 3.8335114318469424`*^9}, {
   3.833615590714979*^9, 3.8336156137952995`*^9}, {3.833615893597701*^9, 
   3.8336159326169543`*^9}, {3.8336159838195415`*^9, 
   3.8336160286447196`*^9}, {3.833616177371918*^9, 3.8336161784436264`*^9}, 
   3.8336162259804935`*^9, {3.8459013109482327`*^9, 3.8459013616038165`*^9}, 
   3.845904478300895*^9},
 CellLabel->"In[86]:=",ExpressionUUID->"37a73900-c0a4-4109-b1e9-4a931f57d249"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{"GraphicsGrid", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"Partition", "[", 
       RowBox[{"#", ",", "2"}], "]"}], "&"}], "@", 
     RowBox[{"interrogationWindows", "[", 
      RowBox[{"[", 
       RowBox[{"212", ";;", "218"}], "]"}], "]"}]}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Dividers", "\[Rule]", "All"}], ",", 
    RowBox[{"ImageSize", "\[Rule]", "Large"}]}], "\[IndentingNewLine]", "]"}],
   "*)"}]], "Input",
 CellChangeTimes->{{3.833612360617796*^9, 3.8336123984858804`*^9}, {
   3.833612601479752*^9, 3.8336126321993523`*^9}, 3.833612770927394*^9, {
   3.833612806895949*^9, 3.8336128153667817`*^9}, {3.833613089480364*^9, 
   3.8336131229997654`*^9}, {3.833615477994214*^9, 3.833615497138054*^9}, {
   3.8368845314837785`*^9, 3.836884573300427*^9}},
 CellLabel->
  "In[117]:=",ExpressionUUID->"bab4d1da-ccd6-4637-b8c6-405f36e37641"]
}, Open  ]],

Cell[CellGroupData[{

Cell["[[ View IW Filtering Steps ]]", "Subsection",
 CellChangeTimes->{{3.833466333862116*^9, 
  3.8334663545491247`*^9}},ExpressionUUID->"4baf2ba5-842f-440f-b5c8-\
b25376a078d1"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"testID", "=", "1"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"windowTestID", "=", "55"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"showLocalFilteringSteps", "=", 
  RowBox[{"GraphicsGrid", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"HighlightImage", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"images", "[", 
           RowBox[{"[", "testID", "]"}], "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Style", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"trueWindowLocations", "[", 
             RowBox[{"[", "windowTestID", "]"}], "]"}], ",", "Red"}], 
           "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}], ",", 
        "\[IndentingNewLine]", "SpanFromLeft", ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"step1", "=", 
          RowBox[{"localImage", "@", 
           RowBox[{"interrogationWindows", "[", 
            RowBox[{"[", 
             RowBox[{"testID", ",", "windowTestID"}], "]"}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"step1", "//", "Colorize"}]}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"step2", "=", 
          RowBox[{"nonlocalCorrection", "@", "step1"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"step2", "//", "Colorize"}]}]}], "\[IndentingNewLine]", 
       "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"step3", "=", 
          RowBox[{"correction", "@", "step2"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"step3", "//", "Colorize"}]}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"step4", "=", 
          RowBox[{"nonlocalFiltered", "@", "step3"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"step4", "//", "Colorize"}]}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"filteringResult", "=", 
          RowBox[{"meanFilter", "@", "step4"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"filteringResult", "//", "Colorize"}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"localSegments", "=", 
         RowBox[{"localSegmentation", "@", "filteringResult"}]}]}], 
       "\[IndentingNewLine]", "}"}]}], "\[IndentingNewLine]", "}"}], ",", 
    RowBox[{"Dividers", "\[Rule]", "All"}], ",", 
    RowBox[{"ImageSize", "\[Rule]", "Large"}]}], "\[IndentingNewLine]", 
   "]"}]}]}], "Input",
 CellChangeTimes->{{3.833465477480434*^9, 3.833465513917963*^9}, {
   3.8334656043123846`*^9, 3.8334656072205644`*^9}, {3.833465647388543*^9, 
   3.833465674899097*^9}, {3.8334657086330996`*^9, 3.833465746527437*^9}, {
   3.833465845599722*^9, 3.8334658652387624`*^9}, {3.8334659103748493`*^9, 
   3.8334659113919897`*^9}, {3.8334659550704503`*^9, 3.833466029960075*^9}, {
   3.833466069542289*^9, 3.8334661216281357`*^9}, {3.8334662171898355`*^9, 
   3.833466223229211*^9}, {3.833467050961754*^9, 3.8334670515586605`*^9}, {
   3.833468009080406*^9, 3.8334680334002395`*^9}, 3.8335114412406216`*^9, {
   3.833511620976758*^9, 3.8335116800645857`*^9}, {3.8335117148557253`*^9, 
   3.8335117157506056`*^9}, {3.833511796393351*^9, 3.8335119112851233`*^9}, {
   3.83351197755229*^9, 3.8335120144574647`*^9}, {3.83351265370396*^9, 
   3.833512657908824*^9}, {3.83361595250037*^9, 3.833615959571951*^9}, {
   3.8336162713729377`*^9, 3.833616271819743*^9}, {3.836884589893587*^9, 
   3.8368845915561423`*^9}},
 CellLabel->"In[87]:=",ExpressionUUID->"354c807a-68ee-4aa9-894e-6bc7a8d86366"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{"Export", "[", 
    RowBox[{
     RowBox[{"nbd", "<>", "\"\<local_filtering.png\>\""}], ",", 
     "showLocalFilteringSteps", ",", 
     RowBox[{"ImageResolution", "\[Rule]", "600"}]}], "]"}], ";"}], 
  "*)"}]], "Input",
 CellChangeTimes->{{3.8334662311667156`*^9, 3.8334662937816043`*^9}, 
   3.8335126616185904`*^9},
 CellLabel->
  "In[121]:=",ExpressionUUID->"d02e3457-d58e-404d-8542-2f6be77e2b4d"]
}, Open  ]],

Cell[CellGroupData[{

Cell["[[ Preview the NM Correction ]]", "Subsection",
 CellChangeTimes->{{3.833466333862116*^9, 3.8334663545491247`*^9}, {
  3.8369899619055233`*^9, 
  3.8369899674503574`*^9}},ExpressionUUID->"9c5b7cb7-388e-42cc-bf66-\
9aa533b97ad3"],

Cell[BoxData[
 RowBox[{"showNonlocalMeansCorrection", "=", 
  RowBox[{"GraphicsRow", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"ColorNegate", "@", 
        RowBox[{"interrogationWindows", "[", 
         RowBox[{"[", 
          RowBox[{"testID", ",", "windowTestID"}], "]"}], "]"}]}], "//", 
       "Colorize"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"nonlocalFiltered", "@", 
        RowBox[{"ColorNegate", "@", 
         RowBox[{"interrogationWindows", "[", 
          RowBox[{"[", 
           RowBox[{"testID", ",", "windowTestID"}], "]"}], "]"}]}]}], "//", 
       "Colorize"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"nonlocalCorrection", "@", "step1"}], "//", "ImageAdjust"}], "//",
        "Colorize"}]}], "\[IndentingNewLine]", "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Dividers", "\[Rule]", "All"}], ",", 
    RowBox[{"ImageSize", "\[Rule]", "Large"}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.833512077889589*^9, 3.8335121110957394`*^9}, {
  3.833512153711689*^9, 3.8335122112510247`*^9}, {3.8335122518580337`*^9, 
  3.8335123159184046`*^9}, {3.83351264783628*^9, 3.8335126785249557`*^9}, {
  3.8335998450708947`*^9, 3.833599845229472*^9}, {3.8336163219729123`*^9, 
  3.8336163288914227`*^9}},
 CellLabel->"In[90]:=",ExpressionUUID->"0e425775-4ddc-461d-8d83-686d14a6f765"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{"Export", "[", 
    RowBox[{
     RowBox[{"nbd", "<>", "\"\<nonlocal_means_correction.png\>\""}], ",", 
     "showNonlocalMeansCorrection", ",", 
     RowBox[{"ImageResolution", "\[Rule]", "600"}]}], "]"}], ";"}], 
  "*)"}]], "Input",
 CellChangeTimes->{{3.8334662311667156`*^9, 3.8334662937816043`*^9}, {
   3.8335126274334188`*^9, 3.833512636772853*^9}, 3.833512683874975*^9},
 CellLabel->
  "In[123]:=",ExpressionUUID->"a83c824c-fcac-475b-891b-c05f4f2ee54b"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Filter IWs & Segment Particles", "Subsection",
 CellChangeTimes->{{3.802684240578278*^9, 3.8026842493824778`*^9}, {
   3.8026846810256166`*^9, 3.8026846892735386`*^9}, {3.815293730992757*^9, 
   3.815293732210492*^9}, {3.8153201243377657`*^9, 3.8153201288422775`*^9}, {
   3.816195718117414*^9, 3.816195741053176*^9}, 3.8333445526604733`*^9, {
   3.833364124390366*^9, 
   3.833364193516828*^9}},ExpressionUUID->"f4e0c877-c4b2-436a-8c88-\
0c1a5cc9c54c"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"batchSize", "=", "50"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"monitorCounter", "=", "0"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Monitor", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"filteredWindows", "=", 
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"monitorCounter", "++"}], ";", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"filteredRegion", "/@", 
            RowBox[{"interrogationWindows", "[", 
             RowBox[{"[", "k", "]"}], "]"}]}], "//", "Parallelize"}]}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"k", ",", "1", ",", "batchSize"}], "}"}]}], 
        "\[IndentingNewLine]", "]"}]}], ";"}], ",", "\[IndentingNewLine]", 
     RowBox[{"progress", "[", 
      RowBox[{"monitorCounter", ",", "batchSize"}], "]"}]}], 
    "\[IndentingNewLine]", "]"}], "//", "AbsoluteTiming"}], 
  "\[IndentingNewLine]", "\n"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"monitorCounter", "=", "0"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Monitor", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"windowMasks", "=", 
      RowBox[{"Table", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"monitorCounter", "++"}], ";", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"localSegmentation", "/@", 
           RowBox[{"filteredWindows", "[", 
            RowBox[{"[", "k", "]"}], "]"}]}], "//", "Parallelize"}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"k", ",", "1", ",", 
          RowBox[{"Length", "@", "filteredWindows"}]}], "}"}]}], 
       "\[IndentingNewLine]", "]"}]}], ",", "\[IndentingNewLine]", 
     RowBox[{"progress", "[", 
      RowBox[{"monitorCounter", ",", 
       RowBox[{"Length", "@", "filteredWindows"}]}], "]"}]}], 
    "\[IndentingNewLine]", "]"}], ";"}], "//", "AbsoluteTiming"}]}], "Input",
 CellChangeTimes->{{3.8336163665757155`*^9, 3.8336163946516857`*^9}, 
   3.833616533516593*^9, {3.83361656636491*^9, 3.8336165711241913`*^9}, {
   3.833617290894533*^9, 3.8336172909733224`*^9}, 3.8336173315339284`*^9, {
   3.833617362277768*^9, 3.833617374965861*^9}, {3.833617425582593*^9, 
   3.8336174531818376`*^9}, {3.833621246434411*^9, 3.8336213173305545`*^9}, {
   3.8336241334233828`*^9, 3.833624139302952*^9}, {3.8336491325715294`*^9, 
   3.8336491583995433`*^9}, {3.8336899086536436`*^9, 
   3.8336899089369135`*^9}, {3.8336901999393883`*^9, 
   3.8336902151178665`*^9}, {3.8336942129168873`*^9, 3.833694226345956*^9}, {
   3.833731018569502*^9, 3.8337310186742516`*^9}, {3.833736276755822*^9, 
   3.8337362770489473`*^9}, {3.833742265217667*^9, 3.8337422664613404`*^9}, {
   3.8337453767033033`*^9, 3.8337453787728243`*^9}, 3.833752802113654*^9, {
   3.833788155255397*^9, 3.8337881555905004`*^9}, {3.8337889149996653`*^9, 
   3.8337889191026864`*^9}, {3.833805939595279*^9, 3.8338059426336455`*^9}, {
   3.8345524701056843`*^9, 3.8345524705928926`*^9}, {3.8345537627376323`*^9, 
   3.8345537649640036`*^9}, {3.836884646227865*^9, 3.836884646348543*^9}, {
   3.8369744756950064`*^9, 3.8369744782155466`*^9}, {3.8459045903073235`*^9, 
   3.8459045903532*^9}},
 CellLabel->"In[91]:=",ExpressionUUID->"0869cc25-8219-425a-b37d-b1f77e08ca17"]
}, Open  ]],

Cell[CellGroupData[{

Cell["[[ Preview Intensity Filter Output ]]", "Subsection",
 CellChangeTimes->{{3.8161869474002137`*^9, 3.8161869738160024`*^9}, {
   3.8163362044174833`*^9, 3.8163362211503696`*^9}, 3.8235283520980687`*^9, {
   3.8334461815895615`*^9, 3.833446183928853*^9}},
 FontSize->24,ExpressionUUID->"c511c223-829c-4fbb-8184-54b95152bea6"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"testID", "=", "1"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"windowID", "=", "216"}], ";"}], "\[IndentingNewLine]"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"testSegmentData", "=", 
    RowBox[{"Flatten", "/@", 
     RowBox[{"(", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"ComponentMeasurements", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"ImageMultiply", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"backgroundBias", "+", 
            RowBox[{"filteredRegion", "@", 
             RowBox[{"interrogationWindows", "[", 
              RowBox[{"[", 
               RowBox[{"testID", ",", "windowID"}], "]"}], "]"}]}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"segmentedRegion", "@", 
            RowBox[{"interrogationWindows", "[", 
             RowBox[{"[", 
              RowBox[{"testID", ",", "windowID"}], "]"}], "]"}]}]}], 
          "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{
          "\"\<MaskedImage\>\"", ",", "\"\<MeanIntensity\>\"", ",", 
           "\"\<MaxIntensity\>\""}], "}"}]}], "\[IndentingNewLine]", "]"}], "/.", 
       RowBox[{"Rule", "\[Rule]", "List"}]}], "\[IndentingNewLine]", 
      ")"}]}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"testIntensity", "=", 
  RowBox[{
   RowBox[{
    RowBox[{"Times", "@@", 
     RowBox[{"#", "[", 
      RowBox[{"[", 
       RowBox[{"3", ";;", "4"}], "]"}], "]"}]}], "&"}], "/@", 
   "testSegmentData"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"#", ">", "0.1"}], "&"}], "/@", "testIntensity"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"testSegmentImages", "=", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"#", "[", 
      RowBox[{"[", "2", "]"}], "]"}], "&"}], "/@", "testSegmentData"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"showIntensityFiltering", "=", 
  RowBox[{"MatrixPlot", "[", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"ImageMultiply", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"backgroundBias", "+", 
        RowBox[{"filteredRegion", "@", 
         RowBox[{"interrogationWindows", "[", 
          RowBox[{"[", 
           RowBox[{"testID", ",", "windowID"}], "]"}], "]"}]}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"segmentedRegion", "@", 
        RowBox[{"interrogationWindows", "[", 
         RowBox[{"[", 
          RowBox[{"testID", ",", "windowID"}], "]"}], "]"}]}]}], 
      "\[IndentingNewLine]", "]"}], "//", "ImageData"}], ",", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"PlotLegends", "\[Rule]", 
     RowBox[{"BarLegend", "@", "Automatic"}]}], ",", 
    RowBox[{"LabelStyle", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{"Black", ",", "Bold", ",", "13"}], "}"}]}], ",", 
    RowBox[{"Frame", "\[Rule]", "True"}], ",", 
    RowBox[{"GridLines", "\[Rule]", "Automatic"}], ",", 
    RowBox[{"FrameLabel", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{"\"\<x\>\"", ",", "\"\<y\>\""}], "}"}]}], ",", 
    RowBox[{"FrameTicks", "->", "None"}]}], "\[IndentingNewLine]", 
   "]"}]}]}], "Input",
 CellChangeTimes->{{3.8160957179914513`*^9, 3.8160957246512213`*^9}, {
   3.816095800291823*^9, 3.816095814304119*^9}, {3.8160967687189074`*^9, 
   3.8160967867608995`*^9}, 3.816101154176646*^9, {3.816187027373425*^9, 
   3.8161870525876193`*^9}, {3.8161895054256487`*^9, 3.8161895054976416`*^9}, 
   3.8161897351236205`*^9, {3.8162647908619623`*^9, 3.8162647916036215`*^9}, {
   3.8163350783836565`*^9, 3.8163350985313854`*^9}, {3.8163351830260243`*^9, 
   3.8163352770487313`*^9}, {3.816335347504282*^9, 3.816335356175025*^9}, {
   3.816336232928287*^9, 3.8163362614873457`*^9}, {3.8333635572121534`*^9, 
   3.833363561282325*^9}, {3.833363614430574*^9, 3.8333636397764683`*^9}, {
   3.8333638656079655`*^9, 3.8333638770323896`*^9}, {3.8333643479120674`*^9, 
   3.8333643639476767`*^9}, {3.8333645459526186`*^9, 3.8333647125736585`*^9}, 
   3.833365414622834*^9, {3.833373523379562*^9, 3.8333735316568403`*^9}, {
   3.833375880056352*^9, 3.8333758801336555`*^9}, {3.8334399964937005`*^9, 
   3.8334399967368894`*^9}, {3.833443301121585*^9, 3.833443322185473*^9}, {
   3.8334433690458536`*^9, 3.8334433713683195`*^9}, {3.8334440705055604`*^9, 
   3.8334440731635156`*^9}, {3.8334459766426067`*^9, 3.833445980553549*^9}, {
   3.8334673640853095`*^9, 3.8334673704340973`*^9}, {3.8334679311386166`*^9, 
   3.8334679600916214`*^9}, {3.8335128047873044`*^9, 
   3.8335128088384247`*^9}, {3.83351307386605*^9, 3.8335130923145776`*^9}, {
   3.8335132218188434`*^9, 3.8335133992289743`*^9}, {3.8335135494973574`*^9, 
   3.8335135537754035`*^9}, {3.833617828327061*^9, 3.833617846405887*^9}},
 CellLabel->"In[96]:=",ExpressionUUID->"8fa87aa9-9d42-4cab-a1af-317e45fd84e6"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{"Export", "[", 
    RowBox[{
     RowBox[{"nbd", "<>", "\"\<intensity_filtering.png\>\""}], ",", 
     "showIntensityFiltering", ",", 
     RowBox[{"ImageResolution", "\[Rule]", "600"}]}], "]"}], ";"}], 
  "*)"}]], "Input",
 CellChangeTimes->{{3.8334662311667156`*^9, 3.8334662937816043`*^9}, {
   3.8335126274334188`*^9, 3.833512636772853*^9}, 3.833512683874975*^9, {
   3.833513542531477*^9, 3.8335135583914366`*^9}},
 CellLabel->
  "In[299]:=",ExpressionUUID->"359aa980-df54-4dcf-91e5-360cbbe912fb"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Intensity Filtering", "Subsection",
 CellChangeTimes->{{3.8161869474002137`*^9, 3.8161869738160024`*^9}, {
   3.8163362044174833`*^9, 3.8163362211503696`*^9}, 3.8235283520980687`*^9, {
   3.833364507531599*^9, 3.833364510814083*^9}},
 FontSize->24,ExpressionUUID->"f3635787-5dbd-4aff-ac16-e8bab07323e1"],

Cell[BoxData[
 RowBox[{
  RowBox[{"intensityThreshold", "=", "0.1"}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.8336927298651295`*^9, 3.83369275908902*^9}},
 CellLabel->
  "In[103]:=",ExpressionUUID->"888b0e38-4efc-49be-be71-e98c13e3c0ae"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"monitorCounter", "=", "0"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Monitor", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"biasedWindows", "=", 
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"monitorCounter", "++"}], ";", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"ImageAdd", "[", 
              RowBox[{"#", ",", "backgroundBias"}], "]"}], "&"}], "/@", 
            RowBox[{"filteredWindows", "[", 
             RowBox[{"[", "k", "]"}], "]"}]}], "//", "Parallelize"}]}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"k", ",", "1", ",", 
           RowBox[{"Length", "@", "filteredWindows"}]}], "}"}]}], 
        "\[IndentingNewLine]", "]"}]}], ";"}], ",", "\[IndentingNewLine]", 
     RowBox[{"progress", "[", 
      RowBox[{"monitorCounter", ",", 
       RowBox[{"Length", "@", "filteredWindows"}]}], "]"}]}], 
    "\[IndentingNewLine]", "]"}], "//", "AbsoluteTiming"}], 
  "\[IndentingNewLine]", "\n"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"monitorCounter", "=", "0"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Monitor", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"maskedLuminanceMaps", "=", 
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"monitorCounter", "++"}], ";", "\[IndentingNewLine]", 
          RowBox[{"Parallelize", "@", 
           RowBox[{"MapThread", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"ImageMultiply", "[", 
               RowBox[{"#1", ",", "#2"}], "]"}], "&"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"{", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"biasedWindows", "[", 
                RowBox[{"[", "k", "]"}], "]"}], ",", "\[IndentingNewLine]", 
               RowBox[{"windowMasks", "[", 
                RowBox[{"[", "k", "]"}], "]"}]}], "\[IndentingNewLine]", 
              "}"}]}], "\[IndentingNewLine]", "]"}]}]}], ",", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"k", ",", "1", ",", 
           RowBox[{"Length", "@", "windowMasks"}]}], "}"}]}], 
        "\[IndentingNewLine]", "]"}]}], ";"}], ",", "\[IndentingNewLine]", 
     RowBox[{"progress", "[", 
      RowBox[{"monitorCounter", ",", 
       RowBox[{"Length", "@", "windowMasks"}]}], "]"}]}], 
    "\[IndentingNewLine]", "]"}], "//", "AbsoluteTiming"}], 
  "\[IndentingNewLine]", "\n"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"getCriterionValues", "=", 
     RowBox[{
      RowBox[{
       RowBox[{"ParallelMap", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"Times", "@@", "#"}], "&"}], "/@", 
           RowBox[{"Last", "/@", 
            RowBox[{"ComponentMeasurements", "[", "\[IndentingNewLine]", 
             RowBox[{"#", ",", 
              RowBox[{"{", 
               RowBox[{"\"\<MeanIntensity\>\"", ",", "\"\<MaxIntensity\>\""}],
                "}"}]}], "\[IndentingNewLine]", "]"}]}]}], "&"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"maskedLuminanceMaps", "[", 
          RowBox[{"[", "#", "]"}], "]"}]}], "\[IndentingNewLine]", "]"}], 
       "&"}], "/@", 
      RowBox[{"Range", "@", 
       RowBox[{"Length", "@", "maskedLuminanceMaps"}]}]}]}], ";"}], "//", 
   "AbsoluteTiming"}], "\[IndentingNewLine]", "\n"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"monitorCounter", "=", "0"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Monitor", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"falsePositiveIDs", "=", 
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"monitorCounter", "++"}], ";", "\[IndentingNewLine]", 
          RowBox[{"Position", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"#", ">", "intensityThreshold"}], "&"}], "/@", 
             RowBox[{"getCriterionValues", "[", 
              RowBox[{"[", 
               RowBox[{"m", ",", "k"}], "]"}], "]"}]}], ",", 
            "\[IndentingNewLine]", "False"}], "\[IndentingNewLine]", "]"}]}], 
         ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"m", ",", "1", ",", 
           RowBox[{"Length", "@", "getCriterionValues"}]}], "}"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"k", ",", "1", ",", 
           RowBox[{"Length", "@", 
            RowBox[{"getCriterionValues", "[", 
             RowBox[{"[", "m", "]"}], "]"}]}]}], "}"}]}], 
        "\[IndentingNewLine]", "]"}]}], ";"}], ",", "\[IndentingNewLine]", 
     RowBox[{"progress", "[", 
      RowBox[{"monitorCounter", ",", 
       RowBox[{"Length", "@", "getCriterionValues"}]}], "]"}]}], 
    "\[IndentingNewLine]", "]"}], "//", "AbsoluteTiming"}], 
  "\[IndentingNewLine]", "\n"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"monitorCounter", "=", "0"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Monitor", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"segmentImages", "=", 
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"monitorCounter", "++"}], ";", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"ComponentMeasurements", "[", "\[IndentingNewLine]", 
              RowBox[{"#", ",", "\"\<Mask\>\""}], "\[IndentingNewLine]", 
              "]"}], "&"}], "/@", 
            RowBox[{"windowMasks", "[", 
             RowBox[{"[", "k", "]"}], "]"}]}], "//", "Parallelize"}]}], ",", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"k", ",", "1", ",", 
           RowBox[{"Length", "@", "windowMasks"}]}], "}"}]}], 
        "\[IndentingNewLine]", "]"}]}], ";"}], ",", "\[IndentingNewLine]", 
     RowBox[{"progress", "[", 
      RowBox[{"monitorCounter", ",", 
       RowBox[{"Length", "@", "windowMasks"}]}], "]"}]}], 
    "\[IndentingNewLine]", "]"}], "//", "AbsoluteTiming"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"monitorCounter", "=", "0"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Monitor", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"blackWindows", "=", 
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"monitorCounter", "++"}], ";", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"Binarize", "[", 
             RowBox[{"#", ",", "1"}], "]"}], "&"}], "/@", 
           RowBox[{"windowMasks", "[", 
            RowBox[{"[", "k", "]"}], "]"}]}]}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"k", ",", "1", ",", 
           RowBox[{"Length", "@", "windowMasks"}]}], "}"}]}], 
        "\[IndentingNewLine]", "]"}]}], ";"}], ",", "\[IndentingNewLine]", 
     RowBox[{"progress", "[", 
      RowBox[{"monitorCounter", ",", 
       RowBox[{"Length", "@", "windowMasks"}]}], "]"}]}], 
    "\[IndentingNewLine]", "]"}], "//", "AbsoluteTiming"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"monitorCounter", "=", "0"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Monitor", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"trueParticleMasks", "=", 
      RowBox[{"Table", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"monitorCounter", "++"}], ";", "\[IndentingNewLine]", 
         RowBox[{"Parallelize", "@", 
          RowBox[{
          "MapThread", "[", "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"(", "\[IndentingNewLine]", 
              RowBox[{"ImageAdd", "[", 
               RowBox[{
               "#1", ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{
                  RowBox[{"If", "[", "\[IndentingNewLine]", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"Length", "@", "#"}], "\[Equal]", "0"}], ",", 
                    "\[IndentingNewLine]", "0", ",", "\[IndentingNewLine]", 
                    RowBox[{"ImageAdd", "@", "#"}]}], "\[IndentingNewLine]", 
                   "]"}], "&"}], "@", 
                 RowBox[{"(", "\[IndentingNewLine]", 
                  RowBox[{"Image", "/@", 
                   RowBox[{"Last", "/@", 
                    RowBox[{"Delete", "[", 
                    RowBox[{"#2", ",", "#3"}], "]"}]}]}], 
                  "\[IndentingNewLine]", ")"}]}]}], "\[IndentingNewLine]", 
               "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]", ")"}], 
             "&"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"{", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"blackWindows", "[", 
               RowBox[{"[", "k", "]"}], "]"}], ",", "\[IndentingNewLine]", 
              RowBox[{"segmentImages", "[", 
               RowBox[{"[", "k", "]"}], "]"}], ",", "\[IndentingNewLine]", 
              RowBox[{"falsePositiveIDs", "[", 
               RowBox[{"[", "k", "]"}], "]"}]}], "\[IndentingNewLine]", 
             "}"}]}], "\[IndentingNewLine]", "]"}]}]}], ",", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"k", ",", "1", ",", 
          RowBox[{"Length", "@", "segmentImages"}]}], "}"}]}], 
       "\[IndentingNewLine]", "]"}]}], ";"}], ",", "\[IndentingNewLine]", 
    RowBox[{"progress", "[", 
     RowBox[{"monitorCounter", ",", 
      RowBox[{"Length", "@", "segmentImages"}]}], "]"}]}], 
   "\[IndentingNewLine]", "]"}], "//", "AbsoluteTiming"}]}], "Input",
 CellChangeTimes->{{3.8336222625147543`*^9, 3.8336223561402283`*^9}, {
   3.8336226757653008`*^9, 3.8336226798048363`*^9}, {3.83362370655911*^9, 
   3.8336237751837535`*^9}, {3.8336241199108076`*^9, 3.83362412407179*^9}, {
   3.8336245798967123`*^9, 3.8336245825635853`*^9}, 3.8336246931615324`*^9, {
   3.8336247327061534`*^9, 3.833624748608656*^9}, {3.8336247940980897`*^9, 
   3.8336247958324547`*^9}, {3.833624898073227*^9, 3.8336249341847267`*^9}, {
   3.8336251630351477`*^9, 3.833625220169462*^9}, {3.833625252146008*^9, 
   3.8336252551928654`*^9}, {3.8336253292569366`*^9, 3.833625331369292*^9}, {
   3.8336255371373973`*^9, 3.8336255381786146`*^9}, {3.8336259038423004`*^9, 
   3.8336259192740602`*^9}, {3.8336269894440393`*^9, 3.8336270024044046`*^9}, 
   3.833631945670611*^9, {3.8336333704613085`*^9, 3.8336333868681903`*^9}, 
   3.8336899798261995`*^9, {3.8336902587001953`*^9, 3.833690260342802*^9}, {
   3.8336904982902713`*^9, 3.833690501736053*^9}, {3.8336942333322687`*^9, 
   3.833694292434165*^9}, {3.833694420814161*^9, 3.8336944247057505`*^9}, 
   3.83370774650849*^9, {3.833709081116825*^9, 3.833709081804291*^9}, {
   3.833709320998452*^9, 3.833709334876833*^9}, 3.833730256056738*^9, 
   3.8337310408236*^9, {3.833731706072553*^9, 3.833731712508922*^9}, {
   3.8337394850890756`*^9, 3.833739489603998*^9}, 3.8337420097764316`*^9, {
   3.8337434278469715`*^9, 3.8337434343705206`*^9}, {3.8337440987264833`*^9, 
   3.8337441288822627`*^9}, {3.833744296050824*^9, 3.833744317830474*^9}, 
   3.833753028921711*^9, 3.8338057318800087`*^9, 3.8459043882780647`*^9},
 CellLabel->
  "In[104]:=",ExpressionUUID->"e09638f7-9106-4046-a8b8-a070f01f83dd"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Assemble the Global Masks", "Subsection",
 CellChangeTimes->{{3.8161869474002137`*^9, 3.8161869738160024`*^9}, {
   3.8163362044174833`*^9, 3.8163362211503696`*^9}, 3.8235283520980687`*^9, {
   3.8333644982915487`*^9, 3.833364503652794*^9}, 3.833633284819133*^9},
 FontSize->24,ExpressionUUID->"7a634953-0386-4260-ac86-78b3a9bffe43"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"blackCanvas", "=", 
    RowBox[{
     RowBox[{
      RowBox[{"Binarize", "[", 
       RowBox[{"#", ",", "1"}], "]"}], "&"}], "@", 
     RowBox[{"First", "@", "images"}]}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"minimumArea", "=", "5"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"openingRadius", "=", "2"}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.8333623785356903`*^9, 3.833362403472906*^9}, {
   3.83336253068904*^9, 3.833362619287709*^9}, {3.8333627017432137`*^9, 
   3.8333627468309693`*^9}, {3.833363473112943*^9, 3.8333634763776026`*^9}, {
   3.83344510486694*^9, 3.8334451092353787`*^9}, {3.8334456613329678`*^9, 
   3.8334456736514874`*^9}, 3.8334472817321544`*^9, {3.8335113332148094`*^9, 
   3.833511334817342*^9}, {3.833631711498436*^9, 3.833631712242141*^9}, {
   3.833693750954672*^9, 3.833693755260154*^9}, {3.833805985330232*^9, 
   3.833805996290123*^9}, {3.836885099741362*^9, 3.836885102548899*^9}},
 CellLabel->
  "In[117]:=",ExpressionUUID->"9e97cd5d-e972-4825-9b67-5c6aa8f3e607"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Monitor", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"globalMasks", "=", 
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"monitorCounter", "++"}], ";", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"Binarize", "[", 
             RowBox[{"#", ",", "0"}], "]"}], "&"}], "@", 
           RowBox[{
           "(", "\[IndentingNewLine]", "\[IndentingNewLine]", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"Parallelize", "@", 
              RowBox[{
              "MapThread", "[", "\[IndentingNewLine]", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{
                 RowBox[{"ImageCompose", "[", "\[IndentingNewLine]", 
                  RowBox[{"blackCanvas", ",", "#1", ",", "#2"}], 
                  "\[IndentingNewLine]", "]"}], "&"}], ",", 
                "\[IndentingNewLine]", "\[IndentingNewLine]", 
                RowBox[{"{", "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"trueParticleMasks", "[", 
                   RowBox[{"[", "k", "]"}], "]"}], ",", "\[IndentingNewLine]",
                   "trueWindowLocations"}], "\[IndentingNewLine]", "}"}]}], 
               "\[IndentingNewLine]", "]"}]}], "//", "ImageAdd"}], 
            "\[IndentingNewLine]", ")"}]}]}], ",", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"k", ",", "1", ",", 
           RowBox[{"Length", "@", "trueParticleMasks"}]}], "}"}]}], 
        "\[IndentingNewLine]", "]"}]}], ";"}], ",", "\[IndentingNewLine]", 
     RowBox[{"progress", "[", 
      RowBox[{"monitorCounter", ",", 
       RowBox[{"Length", "@", "segmentImages"}]}], "]"}]}], 
    "\[IndentingNewLine]", "]"}], "//", "AbsoluteTiming"}], "\n", 
  "\[IndentingNewLine]"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"sizeFilteredMasks", "=", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"SelectComponents", "[", "\[IndentingNewLine]", 
         RowBox[{"#", ",", 
          RowBox[{
           RowBox[{"#Area", ">", "minimumArea"}], "&"}]}], 
         "\[IndentingNewLine]", "]"}], "&"}], "/@", "globalMasks"}], "//", 
      "Parallelize"}]}], ";"}], "//", "AbsoluteTiming"}], 
  "\n"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"cleanGlobalMasks", "=", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"Opening", "[", 
        RowBox[{"#", ",", 
         RowBox[{"DiskMatrix", "@", "openingRadius"}]}], "]"}], "&"}], "/@", 
      "sizeFilteredMasks"}], "//", "Parallelize"}]}], ";"}], "//", 
  "AbsoluteTiming"}]}], "Input",
 CellChangeTimes->{{3.8336324816033993`*^9, 3.8336324850126734`*^9}, {
   3.8336325472435083`*^9, 3.833632569452298*^9}, {3.8336326111150265`*^9, 
   3.8336326279343424`*^9}, {3.8336326790746756`*^9, 3.8336326809395857`*^9}, 
   3.833632722780072*^9, {3.8336331002927856`*^9, 3.833633138532518*^9}, {
   3.8336331896450567`*^9, 3.8336333040766544`*^9}, {3.833633338436287*^9, 
   3.8336333386846232`*^9}, 3.8336334093564444`*^9, 3.833694439816328*^9, {
   3.8337446996447873`*^9, 3.83374470959879*^9}, {3.8337447501488256`*^9, 
   3.833744907202153*^9}, {3.8337450078218355`*^9, 3.83374501992013*^9}, 
   3.8337452227182493`*^9, 3.8338060006923466`*^9, 3.8368851059338617`*^9, {
   3.845904437068593*^9, 3.845904438714192*^9}},
 CellLabel->
  "In[120]:=",ExpressionUUID->"aeb91853-3c43-4a57-ae2e-4a496a9647f1"]
}, Open  ]],

Cell[CellGroupData[{

Cell["<< Export the Global Masks >>", "Subsection",
 CellChangeTimes->{{3.8161869474002137`*^9, 3.8161869738160024`*^9}, {
   3.8163362044174833`*^9, 3.8163362211503696`*^9}, 3.8235283520980687`*^9, {
   3.8333644982915487`*^9, 3.833364503652794*^9}, 3.833633284819133*^9, {
   3.836988049945675*^9, 3.8369880611050997`*^9}},
 FontSize->24,ExpressionUUID->"3e6b3239-23e5-49fb-bb8b-b8fd6e3613cc"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Speak", "@", "\"\<Exporting global masks\>\""}], 
  "\n"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"globalMaskFolder", "=", "\"\<Global Masks\\\\\>\""}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"If", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"DirectoryQ", "[", 
      RowBox[{"outputFolder", "<>", "globalMaskFolder"}], "]"}], ",", 
     "\[IndentingNewLine]", "Nothing", ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"outputFolder", "<>", "globalMaskFolder"}], "//", 
      "CreateDirectory"}]}], "\[IndentingNewLine]", "]"}], ";"}], 
  "\n"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"monitorCounter", "=", "0"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Monitor", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"For", "[", 
     RowBox[{
      RowBox[{"k", "=", "1"}], ",", 
      RowBox[{"k", "\[LessEqual]", 
       RowBox[{"Length", "@", "cleanGlobalMasks"}]}], ",", 
      RowBox[{"k", "++"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Export", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
         "outputFolder", "<>", "globalMaskFolder", "<>", "\"\<Frame_\>\"", "<>", 
          RowBox[{"ToString", "[", "k", "]"}], "<>", "\"\<.png\>\""}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"cleanGlobalMasks", "[", 
          RowBox[{"[", "k", "]"}], "]"}]}], "\[IndentingNewLine]", "]"}], ";",
        "\[IndentingNewLine]", 
       RowBox[{"monitorCounter", "++"}], ";"}]}], "\[IndentingNewLine]", 
     "]"}], ",", "\[IndentingNewLine]", 
    RowBox[{"progress", "[", 
     RowBox[{"monitorCounter", ",", 
      RowBox[{"Length", "@", "cleanGlobalMasks"}]}], "]"}]}], 
   "\[IndentingNewLine]", "]"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"Speak", "@", "\"\<Image export complete\>\""}]}], "Input",
 CellChangeTimes->{{3.8369880632654047`*^9, 3.8369881409051905`*^9}},
 CellLabel->
  "In[123]:=",ExpressionUUID->"d2f79a13-12cf-4fc9-b93e-deb999447c0a"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Get Particle Positions", "Subsection",
 CellChangeTimes->{{3.8161869474002137`*^9, 3.8161869738160024`*^9}, {
   3.8163362044174833`*^9, 3.8163362211503696`*^9}, 3.8235283520980687`*^9, {
   3.8333644982915487`*^9, 3.833364503652794*^9}, {3.833446673448447*^9, 
   3.8334466781462584`*^9}},
 FontSize->24,ExpressionUUID->"57bdb520-788f-4891-98f9-6a6b8042e722"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"findParticles", "[", "image_", "]"}], ":=", 
   RowBox[{"Last", "/@", 
    RowBox[{"(", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"ComponentMeasurements", "[", "\[IndentingNewLine]", 
       RowBox[{"image", ",", "\"\<Centroid\>\"", ",", 
        RowBox[{"CornerNeighbors", "\[Rule]", "False"}]}], 
       "\[IndentingNewLine]", "]"}], "/.", 
      RowBox[{"Rule", "\[Rule]", "List"}]}], "\[IndentingNewLine]", ")"}]}]}],
   ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.833446869312537*^9, 3.833446874071931*^9}, {
  3.833446908542446*^9, 3.8334469144409056`*^9}, {3.833447438498287*^9, 
  3.833447440438592*^9}},
 CellLabel->
  "In[129]:=",ExpressionUUID->"84488b36-3842-494e-96e9-c29901536f56"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"detectedParticles", "=", 
    RowBox[{"findParticles", "/@", "cleanGlobalMasks"}]}], ";"}], "//", 
  "AbsoluteTiming"}]], "Input",
 CellChangeTimes->{{3.8334468870356584`*^9, 3.8334469403119287`*^9}, {
   3.8334474460724325`*^9, 3.833447447654401*^9}, {3.8334672949114656`*^9, 
   3.8334673013804607`*^9}, {3.8335143466689315`*^9, 3.8335143635519657`*^9}, 
   3.833633405404871*^9, {3.8336334461637573`*^9, 3.833633453164048*^9}, {
   3.8336334836206555`*^9, 3.833633502380522*^9}},
 CellLabel->
  "In[130]:=",ExpressionUUID->"78f5f7e9-e4e7-4d54-847b-99a67e851fb8"]
}, Open  ]],

Cell[CellGroupData[{

Cell["[[ View Global Masks & Detected Particles ]]", "Subsection",
 CellChangeTimes->{{3.8161869474002137`*^9, 3.8161869738160024`*^9}, {
   3.8163362044174833`*^9, 3.8163362211503696`*^9}, 3.8235283520980687`*^9, {
   3.8333644982915487`*^9, 3.833364503652794*^9}, {3.8336327646515493`*^9, 
   3.833632778666956*^9}, {3.8336336494446545`*^9, 3.8336336537082605`*^9}},
 FontSize->24,ExpressionUUID->"bd4620b1-9d3a-4104-9cc3-422979811c95"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"testID", "=", "49"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"showRawMask", "=", 
   RowBox[{"HighlightImage", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"ColorNegate", "@", 
       RowBox[{"images", "[", 
        RowBox[{"[", "testID", "]"}], "]"}]}], "//", "Colorize"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"Style", "[", 
      RowBox[{
       RowBox[{"globalMasks", "[", 
        RowBox[{"[", "testID", "]"}], "]"}], ",", "White"}], "]"}]}], 
    "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"showRemovedFeatures", "=", 
   RowBox[{"ImageAdd", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"cleanGlobalMasks", "[", 
      RowBox[{"[", "testID", "]"}], "]"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"ColorReplace", "[", 
        RowBox[{"#", ",", 
         RowBox[{"White", "\[Rule]", "Red"}]}], "]"}], "&"}], "@", 
      RowBox[{"ImageDifference", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"globalMasks", "[", 
         RowBox[{"[", "testID", "]"}], "]"}], ",", 
        RowBox[{"cleanGlobalMasks", "[", 
         RowBox[{"[", "testID", "]"}], "]"}]}], "\[IndentingNewLine]", 
       "]"}]}]}], "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"resolvedParticles", "=", 
  RowBox[{"HighlightImage", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Colorize", "@", 
     RowBox[{"ColorNegate", "@", 
      RowBox[{"images", "[", 
       RowBox[{"[", "testID", "]"}], "]"}]}]}], ",", "\[IndentingNewLine]", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Style", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"ImageMarker", "[", 
         RowBox[{
          RowBox[{"detectedParticles", "[", 
           RowBox[{"[", "testID", "]"}], "]"}], ",", "\"\<Circle\>\""}], 
         "]"}], ",", "\[IndentingNewLine]", "Red", ",", 
        RowBox[{"PointSize", "@", "0.05"}]}], "\[IndentingNewLine]", "]"}], 
      ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Style", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"ImageMarker", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"detectedParticles", "[", 
           RowBox[{"[", "testID", "]"}], "]"}], ",", "\"\<Arrow\>\""}], 
         "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", "White", 
        ",", 
        RowBox[{"PointSize", "@", "0.05"}]}], "\[IndentingNewLine]", "]"}]}], 
     "\[IndentingNewLine]", "}"}]}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "]"}]}]}], "Input",
 CellChangeTimes->{{3.833376653718648*^9, 3.833376656791482*^9}, {
   3.833443472551015*^9, 3.833443474587208*^9}, {3.833443551052663*^9, 
   3.833443555790306*^9}, {3.833443822873866*^9, 3.833443873478747*^9}, {
   3.833444967059157*^9, 3.833444990834895*^9}, {3.833445095999689*^9, 
   3.8334451120736437`*^9}, {3.8334453527108603`*^9, 
   3.8334453651681347`*^9}, {3.8334453995384274`*^9, 3.833445454398283*^9}, {
   3.833445487742513*^9, 3.8334455252305727`*^9}, {3.833445689103628*^9, 
   3.833445692535329*^9}, {3.8334471597215347`*^9, 3.8334471856382813`*^9}, 
   3.833511460920845*^9, {3.8335137463928943`*^9, 3.8335137646881447`*^9}, {
   3.833514303267252*^9, 3.833514335654284*^9}, {3.8335143680756717`*^9, 
   3.833514410452451*^9}, {3.833514468998884*^9, 3.8335144732417355`*^9}, {
   3.8335145411943254`*^9, 3.8335145458482924`*^9}, {3.8335147180648775`*^9, 
   3.833514744333619*^9}, {3.8335147928798532`*^9, 3.833514847418866*^9}, {
   3.833600194104241*^9, 3.8336002139920387`*^9}, {3.8336318264984703`*^9, 
   3.83363186017058*^9}, {3.833632739540345*^9, 3.8336327555774813`*^9}, {
   3.8336327860673423`*^9, 3.833632827643626*^9}, {3.833633655276083*^9, 
   3.8336336704285774`*^9}, {3.8336337534706554`*^9, 
   3.8336337615730033`*^9}, {3.833693888304263*^9, 3.8336939167023053`*^9}, {
   3.833745434832037*^9, 3.833745435131237*^9}, {3.8459048970770082`*^9, 
   3.8459048971797333`*^9}},
 CellLabel->
  "In[135]:=",ExpressionUUID->"55b77502-c2b7-4a29-9976-486201befcf2"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"Export", "[", 
     RowBox[{
      RowBox[{"nbd", "<>", "\"\<frame_negated_colorized.png\>\""}], ",", 
      RowBox[{"Colorize", "@", 
       RowBox[{"ColorNegate", "@", 
        RowBox[{"images", "[", 
         RowBox[{"[", "testID", "]"}], "]"}]}]}], ",", 
      RowBox[{"ImageResolution", "\[Rule]", "500"}]}], "]"}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"Export", "[", 
     RowBox[{
      RowBox[{"nbd", "<>", "\"\<raw_mask_overlay.png\>\""}], ",", 
      "showRawMask", ",", 
      RowBox[{"ImageResolution", "\[Rule]", "700"}]}], "]"}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"Export", "[", 
     RowBox[{
      RowBox[{"nbd", "<>", "\"\<clean_mask.tiff\>\""}], ",", 
      "showRemovedFeatures", ",", 
      RowBox[{"ImageResolution", "\[Rule]", "500"}]}], "]"}], ";"}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"Export", "[", 
     RowBox[{
      RowBox[{"nbd", "<>", "\"\<resolved_particles.png\>\""}], ",", 
      "resolvedParticles", ",", 
      RowBox[{"ImageResolution", "\[Rule]", "500"}]}], "]"}], ";"}], 
   "*)"}]}]], "Input",
 CellChangeTimes->{{3.833376653718648*^9, 3.833376656791482*^9}, {
   3.833443472551015*^9, 3.833443474587208*^9}, {3.833443551052663*^9, 
   3.833443555790306*^9}, {3.833443822873866*^9, 3.833443873478747*^9}, {
   3.833444967059157*^9, 3.833444990834895*^9}, {3.833445095999689*^9, 
   3.8334451120736437`*^9}, {3.8334453527108603`*^9, 
   3.8334453651681347`*^9}, {3.8334453995384274`*^9, 3.833445454398283*^9}, {
   3.833445487742513*^9, 3.8334455252305727`*^9}, {3.833445689103628*^9, 
   3.833445692535329*^9}, {3.8334471597215347`*^9, 3.8334471856382813`*^9}, 
   3.833511460920845*^9, {3.8335137463928943`*^9, 3.8335137646881447`*^9}, {
   3.833514303267252*^9, 3.833514335654284*^9}, {3.8335143680756717`*^9, 
   3.833514410452451*^9}, {3.833514468998884*^9, 3.8335144732417355`*^9}, {
   3.8335145411943254`*^9, 3.8335145458482924`*^9}, {3.8335147180648775`*^9, 
   3.833514744333619*^9}, {3.8335147928798532`*^9, 3.833514847418866*^9}, {
   3.833600194104241*^9, 3.8336002139920387`*^9}, {3.8336318264984703`*^9, 
   3.83363186017058*^9}, {3.833632739540345*^9, 3.8336327555774813`*^9}, {
   3.8336327860673423`*^9, 3.833632827643626*^9}, {3.833633655276083*^9, 
   3.8336336704285774`*^9}, {3.8336337534706554`*^9, 
   3.833633759685048*^9}},ExpressionUUID->"19bfb5bb-7f5a-485a-a87c-\
f2321545a920"]
}, Open  ]],

Cell[CellGroupData[{

Cell["<< Export Data For Tracing (MHT-X) >>", "Subsection",
 CellChangeTimes->{{3.760170781307646*^9, 3.760170821065774*^9}, {
  3.760170896953659*^9, 3.7601709031790094`*^9}, {3.7602506548965907`*^9, 
  3.760250655708435*^9}, {3.760250902949319*^9, 3.760250903588627*^9}, {
  3.7603536058963194`*^9, 3.760353609377013*^9}, {3.7987163301683273`*^9, 
  3.7987163341909256`*^9}, {3.836989986266056*^9, 3.8369899894342146`*^9}},
 FontSize->24,ExpressionUUID->"578f4db3-37dc-4d7f-a46e-a55628a75e63"],

Cell["\<\
Formatting for the Python tracer:

header = {\"Frame\", \"ID\", \"X\", \"Y\"};\
\>", "Abstract",
 CellChangeTimes->{{3.804176614841088*^9, 3.804176637914857*^9}, {
  3.815242771115752*^9, 3.8152427713311386`*^9}, {3.816191822296121*^9, 
  3.8161918235480556`*^9}},ExpressionUUID->"d2b73684-3048-4e0c-bdd6-\
8f3c937826b0"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{"Manipulate", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"detectedParticles", "[", 
      RowBox[{"[", "k", "]"}], "]"}], "//", "ListPlot"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"{", 
     RowBox[{"k", ",", "1", ",", 
      RowBox[{"Length", "@", "detectedParticles"}], ",", "1"}], "}"}]}], 
   "\[IndentingNewLine]", "]"}], "*)"}]], "Input",
 CellChangeTimes->{{3.833693971414977*^9, 3.833693993460985*^9}},
 CellLabel->
  "In[105]:=",ExpressionUUID->"b861b903-ccb1-4259-9810-8106e12c4aa8"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"tracerInput", "=", 
    RowBox[{
     RowBox[{
      RowBox[{"Flatten", "[", 
       RowBox[{"#", ",", "1"}], "]"}], "&"}], "@", 
     RowBox[{"Table", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Flatten", "@", 
        RowBox[{"{", 
         RowBox[{"m", ",", "k", ",", 
          RowBox[{"detectedParticles", "[", 
           RowBox[{"[", 
            RowBox[{"m", ",", "k"}], "]"}], "]"}]}], "}"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"m", ",", "1", ",", 
         RowBox[{"Length", "@", "detectedParticles"}]}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"k", ",", "1", ",", 
         RowBox[{"Length", "@", 
          RowBox[{"detectedParticles", "[", 
           RowBox[{"[", "m", "]"}], "]"}]}]}], "}"}]}], "\[IndentingNewLine]",
       "]"}]}]}], ";"}], "\[IndentingNewLine]"}], "\n", 
 RowBox[{
  RowBox[{"Export", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"outputFolder", "<>", "\"\<Tracer Input.txt\>\""}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Compress", "@", "tracerInput"}]}], "\[IndentingNewLine]", "]"}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.798716336045472*^9, 3.7987163784538975`*^9}, {
   3.798716484673237*^9, 3.7987165077582607`*^9}, {3.798716715607695*^9, 
   3.7987167431510496`*^9}, {3.7987167943731184`*^9, 3.798716844062994*^9}, {
   3.7987258915524864`*^9, 3.7987259042125263`*^9}, 3.7987355734753637`*^9, {
   3.8026936716296225`*^9, 3.8026936826628323`*^9}, {3.802693747392995*^9, 
   3.802693781158203*^9}, {3.8163277945262146`*^9, 3.816327808452453*^9}, {
   3.8336337888700542`*^9, 3.833633791228751*^9}, {3.8459049069070387`*^9, 
   3.84590498606783*^9}},
 CellLabel->
  "In[143]:=",ExpressionUUID->"ceabec75-6570-4e7b-b3a4-2308f499bbd8"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Particle Statistics", "Section",
 CellChangeTimes->{{3.802684240578278*^9, 3.8026842493824778`*^9}, {
  3.8026846810256166`*^9, 3.8026846892735386`*^9}, {3.8026870154806185`*^9, 
  3.8026870220169168`*^9}, {3.8026890915049005`*^9, 
  3.802689093321782*^9}},ExpressionUUID->"9e0b35d8-2b45-454b-9b30-\
75e4a3ed04b6"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"getQSEs", "[", "dataset_", "]"}], ":=", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"raw", "=", "dataset"}], "}"}], ",", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"controlValueCount", "=", 
       RowBox[{"Length", "@", "raw"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"envelopeFunctions", "=", 
       RowBox[{"QuantileRegression", "[", "\[IndentingNewLine]", 
        RowBox[{"raw", ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"sizeFactor", "*", 
           RowBox[{"Length", "@", "raw"}]}], "//", "Round"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"1", "-", "envelopeQuantile"}], ",", "envelopeQuantile"}], 
          "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{"InterpolationOrder", "\[Rule]", "splineOrder"}]}], 
        "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", "\n", 
      RowBox[{"envelopePoints", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Range", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Min", "@", "#"}], ",", "\[IndentingNewLine]", 
           RowBox[{"Max", "@", "#"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Max", "@", "#"}], "/", "controlValueCount"}]}], 
          "\[IndentingNewLine]", "]"}], "&"}], "@", 
        RowBox[{"First", "@", 
         RowBox[{"Transpose", "@", "raw"}]}]}]}], ";", "\[IndentingNewLine]", 
      "\n", 
      RowBox[{"envelopeValues", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Table", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"envelopeFunctions", "[", 
             RowBox[{"[", "#", "]"}], "]"}], "[", "k", "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{"k", ",", "envelopePoints"}], "}"}]}], 
          "\[IndentingNewLine]", "]"}], "&"}], "/@", 
        RowBox[{"Range", "@", 
         RowBox[{"Length", "@", "envelopeFunctions"}]}]}]}], ";", "\n", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"TotalVariationFilter", "[", "\[IndentingNewLine]", 
         RowBox[{
         "#", ",", "envelopeRegularization", ",", "\[IndentingNewLine]", 
          RowBox[{"Method", "\[Rule]", "\"\<Gaussian\>\""}], ",", 
          RowBox[{"MaxIterations", "\[Rule]", "Automatic"}]}], 
         "\[IndentingNewLine]", "]"}], "&"}], "/@", "envelopeValues"}]}]}], 
    "\[IndentingNewLine]", "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"dataQSEplot", "[", 
   RowBox[{"raw_", ",", "label_"}], "]"}], ":=", 
  RowBox[{"Show", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"ListPlot", "[", 
       RowBox[{"raw", ",", 
        RowBox[{"PlotStyle", "\[Rule]", "Black"}]}], "]"}], ",", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"ListLinePlot", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"TotalVariationFilter", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Last", "/@", "raw"}], ",", "dataRegularization"}], 
         "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"PlotStyle", "\[Rule]", 
         RowBox[{"{", 
          RowBox[{"Red", ",", "Thick"}], "}"}]}]}], "\[IndentingNewLine]", 
       "]"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"ListLinePlot", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"getQSEs", "@", "raw"}], ",", 
        RowBox[{"PlotStyle", "\[Rule]", 
         RowBox[{"Lighter", "@", "Black"}]}], ",", "\[IndentingNewLine]", 
        RowBox[{"Filling", "\[Rule]", " ", 
         RowBox[{"{", 
          RowBox[{"1", "\[Rule]", 
           RowBox[{"{", "2", "}"}]}], "}"}]}], ",", 
        RowBox[{"FillingStyle", "\[Rule]", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Lighter", "@", "Gray"}], ",", 
           RowBox[{"Opacity", "@", "0.25"}]}], "}"}]}]}], 
       "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
     "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"FrameLabel", "\[Rule]", "label"}], ",", 
    RowBox[{"LabelStyle", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{"Black", ",", "Bold", ",", "16"}], "}"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.8084059740690823`*^9, 3.8084059760507617`*^9}, {
   3.8084061589285507`*^9, 3.808406189160034*^9}, {3.8084062839195075`*^9, 
   3.80840631590282*^9}, {3.808407178688931*^9, 3.808407196506467*^9}, 
   3.808407390433344*^9, {3.808407446047789*^9, 3.808407447415123*^9}, 
   3.808407831862463*^9, 3.8084078718377795`*^9, {3.8084211494733267`*^9, 
   3.808421154392722*^9}, {3.808480137503909*^9, 3.808480165308832*^9}, {
   3.808565545491434*^9, 3.808565545522419*^9}, {3.8085657421772566`*^9, 
   3.808565742286791*^9}, {3.808565790427083*^9, 3.8085658117078333`*^9}, 
   3.808647297464489*^9, {3.833800147859602*^9, 3.833800149852274*^9}, {
   3.833801783003674*^9, 3.8338017982998066`*^9}, {3.8338055022879333`*^9, 
   3.833805518751989*^9}, {3.833805575191006*^9, 3.8338055779517417`*^9}, {
   3.8338110364192705`*^9, 3.8338110368979397`*^9}, {3.8338112060221834`*^9, 
   3.8338112294846487`*^9}, {3.8338112633653336`*^9, 
   3.8338112653330374`*^9}, {3.8345535146091623`*^9, 
   3.8345536330808325`*^9}, {3.836987006290674*^9, 3.836987011808365*^9}, {
   3.8369876277298517`*^9, 3.8369876524569387`*^9}, {3.8369877134098487`*^9, 
   3.836987720008663*^9}, {3.8369879329779263`*^9, 3.836987933224944*^9}},
 CellLabel->
  "In[145]:=",ExpressionUUID->"3d30c912-67c9-43fc-9363-b867c634ff8b"],

Cell[CellGroupData[{

Cell["Particle Count ", "Subsection",
 CellChangeTimes->{{3.8026874374155703`*^9, 3.802687448850401*^9}, {
  3.802687575221371*^9, 3.802687651011721*^9}, {3.802689106216844*^9, 
  3.8026891221210546`*^9}},ExpressionUUID->"0f82a876-aa47-44b3-94c6-\
d3d73557dd63"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"sizeFactor", "=", "0.05"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"splineOrder", "=", "3"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"dataRegularization", "=", "2"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"envelopeRegularization", "=", "2"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"envelopeQuantile", "=", "0.90"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"fontSize", "=", "16"}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.836988642217188*^9, 3.836988646929584*^9}},
 CellLabel->
  "In[147]:=",ExpressionUUID->"8938b45f-5be0-45e0-968c-4340b55c65a9"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"particleCount", "=", 
    RowBox[{
     RowBox[{"{", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Range", "@", 
        RowBox[{"Length", "@", "detectedParticles"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"Length", "/@", "detectedParticles"}]}], "\[IndentingNewLine]",
       "}"}], "//", "Transpose"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"label", "=", 
    RowBox[{"{", 
     RowBox[{"\"\<Frame\>\"", ",", "\"\<Particles\>\""}], "}"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"plotParticleCount", "=", 
   RowBox[{"dataQSEplot", "[", 
    RowBox[{"particleCount", ",", "label"}], "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Mean", "@", "#"}], ",", 
       RowBox[{"StandardDeviation", "@", "#"}]}], "}"}], "&"}], "@", 
    RowBox[{"(", 
     RowBox[{"Last", "/@", "particleCount"}], ")"}]}], "//", "N"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"plotParticleCountHistogram", "=", 
  RowBox[{"Histogram", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Last", "/@", "particleCount"}], ",", "\"\<Scott\>\"", ",", 
    RowBox[{"FrameLabel", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{"\"\<N\>\"", ",", 
       RowBox[{"Last", "@", "label"}]}], "}"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]}], "Input",
 CellChangeTimes->{{3.8338000359809694`*^9, 3.8338000973988667`*^9}, {
   3.833800210932568*^9, 3.8338002325102177`*^9}, {3.833801816420367*^9, 
   3.833801823442582*^9}, {3.833806047344134*^9, 3.833806049467454*^9}, {
   3.8338109097396536`*^9, 3.8338109157979836`*^9}, {3.8338109521318455`*^9, 
   3.8338109573174253`*^9}, 3.8338110015260644`*^9, {3.8338110727961593`*^9, 
   3.833811079732178*^9}, {3.833811137469508*^9, 3.8338111752026496`*^9}, {
   3.8338112370938673`*^9, 3.8338112513899794`*^9}, {3.8345535643167114`*^9, 
   3.834553601394439*^9}, {3.8369866641125164`*^9, 3.836986675727906*^9}, {
   3.8369870267522507`*^9, 3.8369870272497253`*^9}, {3.836987636945974*^9, 
   3.8369876422492504`*^9}, {3.8369877112737074`*^9, 
   3.8369877114003677`*^9}, {3.836988318544938*^9, 3.8369883387700567`*^9}, {
   3.8369884235701237`*^9, 3.836988425729434*^9}, {3.836988480657802*^9, 
   3.836988501961747*^9}, {3.8369887094750595`*^9, 3.836988709833608*^9}, {
   3.836988840562125*^9, 3.8369888408673086`*^9}, 3.8369889574670744`*^9, {
   3.836989834506844*^9, 3.8369898352207055`*^9}},
 CellLabel->
  "In[153]:=",ExpressionUUID->"3f6436c5-7742-4f22-abac-f275a25df8ba"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Solid Fraction", "Subsection",
 CellChangeTimes->{{3.8026874374155703`*^9, 3.802687448850401*^9}, {
  3.802687575221371*^9, 3.802687651011721*^9}, {3.802689106216844*^9, 
  3.8026891221210546`*^9}, {3.836988278496596*^9, 
  3.8369882903849664`*^9}},ExpressionUUID->"011b7a48-4fdb-4ab4-b782-\
936acb2d7572"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"referenceArea", "=", 
   RowBox[{"Times", "@@", 
    RowBox[{"ImageDimensions", "@", 
     RowBox[{"First", "@", "cleanGlobalMasks"}]}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"solidFraction", "=", 
    RowBox[{
     RowBox[{"Parallelize", "[", 
      RowBox[{"Total", "/@", "cleanGlobalMasks"}], "]"}], "/", 
     "referenceArea"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"solidFraction", "=", 
    RowBox[{
     RowBox[{"{", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Range", "@", 
        RowBox[{"Length", "@", "solidFraction"}]}], ",", 
       "\[IndentingNewLine]", "solidFraction"}], "\[IndentingNewLine]", "}"}],
      "//", "Transpose"}]}], ";"}], "\n"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"label", "=", 
    RowBox[{"{", 
     RowBox[{"\"\<Frame\>\"", ",", "\"\<Solid Fraction\>\""}], "}"}]}], ";"}],
   "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"plotSolidFraction", "=", 
   RowBox[{"dataQSEplot", "[", 
    RowBox[{"solidFraction", ",", "label"}], "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"Mean", "@", "#"}], ",", 
      RowBox[{"StandardDeviation", "@", "#"}]}], "}"}], "&"}], "@", 
   RowBox[{"(", 
    RowBox[{"Last", "/@", "solidFraction"}], ")"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"plotSolidFractionHistogram", "=", 
  RowBox[{"Histogram", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Last", "/@", "solidFraction"}], ",", "\"\<Scott\>\"", ",", 
    RowBox[{"FrameLabel", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{"\"\<N\>\"", ",", 
       RowBox[{"Last", "@", "label"}]}], "}"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]}], "Input",
 CellChangeTimes->{{3.8369824926174173`*^9, 3.8369825526937065`*^9}, {
   3.836982582781749*^9, 3.83698259034873*^9}, {3.836986092424325*^9, 
   3.8369862159323344`*^9}, {3.8369862735134926`*^9, 3.836986280257986*^9}, {
   3.8369870855638905`*^9, 3.836987110161874*^9}, {3.8369871891686115`*^9, 
   3.8369873104480906`*^9}, 3.8369874226090946`*^9, {3.8369878178411427`*^9, 
   3.836987823131012*^9}, {3.8369882945777273`*^9, 3.83698830924914*^9}, {
   3.8369883425240784`*^9, 3.836988350705001*^9}, {3.836988431162117*^9, 
   3.836988433753287*^9}, {3.8369888190893593`*^9, 3.8369888195236025`*^9}, {
   3.836988920993905*^9, 3.8369889449647264`*^9}, {3.8369898425793753`*^9, 
   3.8369898437007*^9}},
 CellLabel->
  "In[158]:=",ExpressionUUID->"7fd55ef0-d854-4667-aa3e-498efc44223c"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Particle Detection Density", "Subsection",
 CellChangeTimes->{{3.8026874374155703`*^9, 3.802687448850401*^9}, {
  3.802687575221371*^9, 3.802687651011721*^9}, {3.802689106216844*^9, 
  3.8026891221210546`*^9}, {3.8337999636579905`*^9, 
  3.8337999689345202`*^9}},ExpressionUUID->"1b930816-87f0-4ec9-b8a2-\
c5ebecfef6bc"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"plotPointCount", "=", "100"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"colorScheme", "=", 
   RowBox[{"{", 
    RowBox[{"\"\<RedBlueTones\>\"", ",", "\"\<Reverse\>\""}], "}"}]}], 
  ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.8337958324704695`*^9, 3.83379584398002*^9}, {
   3.833795883944154*^9, 3.833795901651125*^9}, {3.833796157982735*^9, 
   3.8337965403376703`*^9}, {3.833796574875045*^9, 3.833796625763013*^9}, {
   3.833796669430915*^9, 3.8337967028593884`*^9}, {3.8337968564637413`*^9, 
   3.833796908406666*^9}, {3.8338049915020475`*^9, 3.8338050196345563`*^9}, {
   3.833805055186211*^9, 3.833805067004741*^9}, {3.8338051265312967`*^9, 
   3.8338051781105776`*^9}, 3.8338052122643204`*^9, {3.8338052426675615`*^9, 
   3.833805302465808*^9}, {3.8338056342816734`*^9, 3.833805635820732*^9}, 
   3.833806066845989*^9},
 CellLabel->
  "In[165]:=",ExpressionUUID->"d7d9df58-06c9-4e25-bb7f-487a2db5dac0"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"plotDetectionDensityAll", "=", 
    RowBox[{
    "SmoothDensityHistogram", "[", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"Flatten", "[", 
         RowBox[{"#", ",", "1"}], "]"}], "&"}], "@", "detectedParticles"}], 
      ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"AspectRatio", "\[Rule]", 
       RowBox[{"2", "/", "5"}]}], ",", 
      RowBox[{"Frame", "\[Rule]", "True"}], ",", 
      RowBox[{"ImageSize", "\[Rule]", "Large"}], ",", 
      RowBox[{"FrameLabel", "\[Rule]", 
       RowBox[{"{", 
        RowBox[{"\"\<X\>\"", ",", "\"\<Y\>\""}], "}"}]}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"LabelStyle", "\[Rule]", 
       RowBox[{"{", 
        RowBox[{"Black", ",", "Bold", ",", "15"}], "}"}]}], ",", 
      RowBox[{"ColorFunction", "\[Rule]", 
       RowBox[{"ColorData", "[", "colorScheme", "]"}]}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"Mesh", "\[Rule]", "5"}], ",", 
      RowBox[{"MeshStyle", "\[Rule]", 
       RowBox[{"{", "White", "}"}]}], ",", "\[IndentingNewLine]", 
      RowBox[{"PerformanceGoal", "\[Rule]", "\"\<Quality\>\""}], ",", 
      RowBox[{"MaxRecursion", "\[Rule]", "3"}], ",", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"PlotPoints", "\[Rule]", 
       RowBox[{"{", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"plotPointCount", "*", 
           RowBox[{"Divide", "@@", 
            RowBox[{"ImageDimensions", "@", 
             RowBox[{"First", "@", "images"}]}]}]}], "//", "Round"}], ",", 
         "\[IndentingNewLine]", "plotPointCount"}], "\[IndentingNewLine]", 
        "}"}]}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"PlotLegends", "\[Rule]", 
       RowBox[{"Placed", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"BarLegend", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"{", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"ColorData", "[", "colorScheme", "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"0", ",", "1"}], "}"}]}], "\[IndentingNewLine]", "}"}], 
           ",", "\[IndentingNewLine]", "Automatic", ",", 
           RowBox[{"LegendMarkerSize", "\[Rule]", "250"}]}], 
          "\[IndentingNewLine]", "]"}], ",", "Right"}], "\[IndentingNewLine]",
         "]"}]}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", "]"}]}], 
   ";"}], "//", "AbsoluteTiming"}]], "Input",
 CellChangeTimes->{{3.8337958324704695`*^9, 3.83379584398002*^9}, {
   3.833795883944154*^9, 3.833795901651125*^9}, {3.833796157982735*^9, 
   3.8337965403376703`*^9}, {3.833796574875045*^9, 3.833796625763013*^9}, {
   3.833796669430915*^9, 3.8337967028593884`*^9}, {3.8337968564637413`*^9, 
   3.833796908406666*^9}, {3.8338049915020475`*^9, 3.8338050196345563`*^9}, {
   3.833805055186211*^9, 3.833805067004741*^9}, {3.8338051265312967`*^9, 
   3.8338051781105776`*^9}, 3.8338052122643204`*^9, {3.8338052426675615`*^9, 
   3.833805302465808*^9}, {3.8338056342816734`*^9, 3.833805635820732*^9}, {
   3.833806066845989*^9, 3.8338060685324783`*^9}, 3.8369887978185863`*^9},
 CellLabel->
  "In[167]:=",ExpressionUUID->"dbd61753-a3ab-4356-92e7-c06465ed0ff2"],

Cell[BoxData["plotDetectionDensityAll"], "Input",
 CellChangeTimes->{{3.836885301279225*^9, 3.8368853023905697`*^9}},
 CellLabel->
  "In[168]:=",ExpressionUUID->"781c4bf4-04cb-4479-8173-9d7751ef7cbd"]
}, Open  ]],

Cell[CellGroupData[{

Cell["<< Export the Statistics Plots & Data>>", "Subsection",
 CellChangeTimes->{{3.760170781307646*^9, 3.760170821065774*^9}, {
  3.760170896953659*^9, 3.7601709031790094`*^9}, {3.7602506548965907`*^9, 
  3.760250655708435*^9}, {3.760250902949319*^9, 3.760250903588627*^9}, {
  3.7603536058963194`*^9, 3.760353609377013*^9}, {3.7987163301683273`*^9, 
  3.7987163341909256`*^9}, {3.802712254857705*^9, 3.8027122692971277`*^9}, {
  3.8027153348273935`*^9, 3.802715343467758*^9}, {3.8338049661848135`*^9, 
  3.8338049696406326`*^9}, {3.833805753324645*^9, 3.833805754026764*^9}, {
  3.8369885248486137`*^9, 
  3.8369885255853148`*^9}},ExpressionUUID->"062f0d0a-adb1-45f6-8510-\
aa935961f160"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"imageNames", "=", 
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
     "\"\<particle_count.jpg\>\"", ",", "\[IndentingNewLine]", 
      "\"\<particle_count_histogram.jpg\>\"", ",", "\[IndentingNewLine]", 
      "\"\<solid_fraction.jpg\>\"", ",", "\[IndentingNewLine]", 
      "\"\<solid_fraction_histogram.jpg\>\"", ",", "\[IndentingNewLine]", 
      "\"\<detection_density_all_frames.jpg\>\""}], "\[IndentingNewLine]", 
     "}"}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"plots", "=", 
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
     "plotParticleCount", ",", "\[IndentingNewLine]", 
      "plotParticleCountHistogram", ",", "\[IndentingNewLine]", 
      "plotSolidFraction", ",", "\[IndentingNewLine]", 
      "plotSolidFractionHistogram", ",", "\[IndentingNewLine]", 
      "plotDetectionDensityAll"}], "\[IndentingNewLine]", "}"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"imageResolution", "=", 
    RowBox[{"{", 
     RowBox[{"500", ",", "500", ",", "500", ",", "500", ",", "600"}], "}"}]}],
    ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"MapThread", "[", "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"Export", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"outputFolder", "<>", "#1"}], ",", "\[IndentingNewLine]", 
        "#2", ",", 
        RowBox[{"ImageResolution", "\[Rule]", "#3"}]}], "\[IndentingNewLine]",
        "]"}], "&"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"imageNames", ",", "plots", ",", "imageResolution"}], "}"}]}], 
    "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]", 
  "\n"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Export", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"outputFolder", "<>", "\"\<particle_count.txt\>\""}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"Compress", "@", "particleCount"}]}], "\[IndentingNewLine]", 
    "]"}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Export", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"outputFolder", "<>", "\"\<solid_fraction.txt\>\""}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Compress", "@", "solidFraction"}]}], "\[IndentingNewLine]", 
   "]"}], ";"}]}], "Input",
 CellChangeTimes->{{3.8369896321716285`*^9, 3.8369898142432957`*^9}, {
  3.836989875317026*^9, 3.8369898781064835`*^9}},
 CellLabel->
  "In[169]:=",ExpressionUUID->"37db3755-6320-4b6e-b85a-0ab0220cbd6d"]
}, Open  ]]
}, Open  ]]
},
WindowSize->{1278, 1348},
WindowMargins->{{Automatic, -7}, {Automatic, 0}},
TaggingRules->{"TryRealOnly" -> False},
CellContext->Notebook,
Magnification:>1.2 Inherited,
FrontEndVersion->"12.1 for Microsoft Windows (64-bit) (June 9, 2020)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"adbd3b31-53b0-4c9a-8d77-6ce105f5e4be"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 155, 3, 80, "Section",ExpressionUUID->"6712c0a3-c415-49f1-bcb4-37f449375766"],
Cell[738, 27, 13076, 300, 2840, "Input",ExpressionUUID->"33230b11-4249-4515-99fe-7cc4a266cb25",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[13839, 331, 720, 10, 65, "Subsection",ExpressionUUID->"9613a0cf-e9a0-4762-9d69-90d01789c1b9"],
Cell[14562, 343, 1746, 35, 300, "Input",ExpressionUUID->"2517dd0c-e81e-49d7-be8f-dfc90a561b88"]
}, Open  ]],
Cell[CellGroupData[{
Cell[16345, 383, 727, 10, 65, "Subsection",ExpressionUUID->"f3dfa33c-689a-474f-a224-406533410d92"],
Cell[17075, 395, 783, 15, 108, "Input",ExpressionUUID->"edde4f0a-9198-48eb-8468-d2fe5c7a3673"]
}, Open  ]],
Cell[CellGroupData[{
Cell[17895, 415, 731, 10, 65, "Subsection",ExpressionUUID->"b0157643-4a6b-4e49-ad69-778df8958543"],
Cell[18629, 427, 845, 14, 60, "Input",ExpressionUUID->"9e02d763-462d-43e7-92cc-59f42fb63101"],
Cell[19477, 443, 1156, 31, 200, "Input",ExpressionUUID->"e313a4df-6f8e-4f9e-a20f-0c531a4c9605",
 InitializationCell->True],
Cell[20636, 476, 1879, 43, 324, "Input",ExpressionUUID->"d7e4f08d-416c-48fd-9aa6-0849b48c0eea"],
Cell[22518, 521, 1240, 26, 276, "Input",ExpressionUUID->"8560e631-1902-499c-9087-a63888e3e317"],
Cell[23761, 549, 913, 19, 276, "Input",ExpressionUUID->"f7060faf-147b-4d69-93f4-2aa20d149188"]
}, Open  ]],
Cell[CellGroupData[{
Cell[24711, 573, 885, 13, 65, "Subsection",ExpressionUUID->"12fdf088-b5f8-4e0e-af3a-8328a9757651"],
Cell[25599, 588, 505, 11, 108, "Input",ExpressionUUID->"3dfeb144-73d9-4329-a185-7dde7922778d"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[26153, 605, 165, 3, 80, "Section",ExpressionUUID->"087dd570-4e5e-4c06-994a-9ae95ddf2b3f"],
Cell[CellGroupData[{
Cell[26343, 612, 403, 6, 65, "Subsection",ExpressionUUID->"c541d18d-ded8-44ab-9450-60634f170e8d"],
Cell[26749, 620, 416, 14, 323, "Abstract",ExpressionUUID->"b49caba2-1040-43f7-9729-416190f7f017"],
Cell[27168, 636, 4739, 108, 824, "Input",ExpressionUUID->"d794ac8d-786b-4679-869d-65f64ebb26f1",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[31944, 749, 571, 8, 65, "Subsection",ExpressionUUID->"dc1c4721-1dcf-4cba-85b6-ce9411393e87"],
Cell[32518, 759, 2224, 57, 468, "Input",ExpressionUUID->"599c87bb-e197-4b5c-9b12-019968b6d00e"]
}, Open  ]],
Cell[CellGroupData[{
Cell[34779, 821, 441, 7, 65, "Subsection",ExpressionUUID->"75760629-112e-453c-82f4-280acb90a956"],
Cell[35223, 830, 227, 8, 185, "Abstract",ExpressionUUID->"e855621a-f2ac-4045-a6b5-994536e5d351"],
Cell[35453, 840, 229, 4, 35, "Input",ExpressionUUID->"d54cbfdb-f95a-4d83-9e67-ed281b69a3ee"],
Cell[35685, 846, 2214, 44, 200, "Input",ExpressionUUID->"c3037abd-5f02-48e9-8f16-70e29aec921b",
 InitializationCell->True],
Cell[37902, 892, 2938, 86, 468, "Input",ExpressionUUID->"743f18b6-b082-484c-a1df-766d6ea95df0"],
Cell[40843, 980, 2025, 36, 204, "Input",ExpressionUUID->"37a73900-c0a4-4109-b1e9-4a931f57d249"],
Cell[42871, 1018, 935, 21, 108, "Input",ExpressionUUID->"bab4d1da-ccd6-4637-b8c6-405f36e37641"]
}, Open  ]],
Cell[CellGroupData[{
Cell[43843, 1044, 179, 3, 65, "Subsection",ExpressionUUID->"4baf2ba5-842f-440f-b5c8-b25376a078d1"],
Cell[44025, 1049, 3716, 74, 708, "Input",ExpressionUUID->"354c807a-68ee-4aa9-894e-6bc7a8d86366"],
Cell[47744, 1125, 453, 12, 35, "Input",ExpressionUUID->"d02e3457-d58e-404d-8542-2f6be77e2b4d"]
}, Open  ]],
Cell[CellGroupData[{
Cell[48234, 1142, 234, 4, 65, "Subsection",ExpressionUUID->"9c5b7cb7-388e-42cc-bf66-9aa533b97ad3"],
Cell[48471, 1148, 1464, 32, 204, "Input",ExpressionUUID->"0e425775-4ddc-461d-8d83-686d14a6f765"],
Cell[49938, 1182, 513, 12, 35, "Input",ExpressionUUID->"a83c824c-fcac-475b-891b-c05f4f2ee54b"]
}, Open  ]],
Cell[CellGroupData[{
Cell[50488, 1199, 459, 7, 65, "Subsection",ExpressionUUID->"f4e0c877-c4b2-436a-8c88-0c1a5cc9c54c"],
Cell[50950, 1208, 3516, 75, 588, "Input",ExpressionUUID->"0869cc25-8219-425a-b37d-b1f77e08ca17"]
}, Open  ]],
Cell[CellGroupData[{
Cell[54503, 1288, 329, 4, 71, "Subsection",ExpressionUUID->"c511c223-829c-4fbb-8184-54b95152bea6"],
Cell[54835, 1294, 4954, 104, 708, "Input",ExpressionUUID->"8fa87aa9-9d42-4cab-a1af-317e45fd84e6"],
Cell[59792, 1400, 554, 13, 35, "Input",ExpressionUUID->"359aa980-df54-4dcf-91e5-360cbbe912fb"]
}, Open  ]],
Cell[CellGroupData[{
Cell[60383, 1418, 309, 4, 71, "Subsection",ExpressionUUID->"f3635787-5dbd-4aff-ac16-e8bab07323e1"],
Cell[60695, 1424, 263, 6, 55, "Input",ExpressionUUID->"888b0e38-4efc-49be-be71-e98c13e3c0ae",
 InitializationCell->True],
Cell[60961, 1432, 12047, 274, 2772, "Input",ExpressionUUID->"e09638f7-9106-4046-a8b8-a070f01f83dd"]
}, Open  ]],
Cell[CellGroupData[{
Cell[73045, 1711, 339, 4, 71, "Subsection",ExpressionUUID->"7a634953-0386-4260-ac86-78b3a9bffe43"],
Cell[73387, 1717, 1127, 24, 128, "Input",ExpressionUUID->"9e97cd5d-e972-4825-9b67-5c6aa8f3e607",
 InitializationCell->True],
Cell[74517, 1743, 3546, 81, 732, "Input",ExpressionUUID->"aeb91853-3c43-4a57-ae2e-4a496a9647f1"]
}, Open  ]],
Cell[CellGroupData[{
Cell[78100, 1829, 395, 5, 71, "Subsection",ExpressionUUID->"3e6b3239-23e5-49fb-bb8b-b8fd6e3613cc"],
Cell[78498, 1836, 2080, 50, 564, "Input",ExpressionUUID->"d2f79a13-12cf-4fc9-b93e-deb999447c0a"]
}, Open  ]],
Cell[CellGroupData[{
Cell[80615, 1891, 366, 5, 71, "Subsection",ExpressionUUID->"57bdb520-788f-4891-98f9-6a6b8042e722"],
Cell[80984, 1898, 774, 18, 152, "Input",ExpressionUUID->"84488b36-3842-494e-96e9-c29901536f56",
 InitializationCell->True],
Cell[81761, 1918, 612, 12, 35, "Input",ExpressionUUID->"78f5f7e9-e4e7-4d54-847b-99a67e851fb8"]
}, Open  ]],
Cell[CellGroupData[{
Cell[82410, 1935, 438, 5, 71, "Subsection",ExpressionUUID->"bd4620b1-9d3a-4104-9cc3-422979811c95"],
Cell[82851, 1942, 4324, 90, 852, "Input",ExpressionUUID->"55b77502-c2b7-4a29-9976-486201befcf2"],
Cell[87178, 2034, 2473, 51, 108, "Input",ExpressionUUID->"19bfb5bb-7f5a-485a-a87c-f2321545a920"]
}, Open  ]],
Cell[CellGroupData[{
Cell[89688, 2090, 495, 6, 71, "Subsection",ExpressionUUID->"578f4db3-37dc-4d7f-a46e-a55628a75e63"],
Cell[90186, 2098, 331, 8, 127, "Abstract",ExpressionUUID->"d2b73684-3048-4e0c-bdd6-8f3c937826b0"],
Cell[90520, 2108, 565, 14, 108, "Input",ExpressionUUID->"b861b903-ccb1-4259-9810-8106e12c4aa8"],
Cell[91088, 2124, 1839, 43, 252, "Input",ExpressionUUID->"ceabec75-6570-4e7b-b3a4-2308f499bbd8"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[92976, 2173, 320, 5, 80, "Section",ExpressionUUID->"9e0b35d8-2b45-454b-9b30-75e4a3ed04b6"],
Cell[93299, 2180, 5914, 126, 1256, "Input",ExpressionUUID->"3d30c912-67c9-43fc-9363-b867c634ff8b",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[99238, 2310, 262, 4, 65, "Subsection",ExpressionUUID->"0f82a876-aa47-44b3-94c6-d3d73557dd63"],
Cell[99503, 2316, 751, 20, 224, "Input",ExpressionUUID->"8938b45f-5be0-45e0-968c-4340b55c65a9",
 InitializationCell->True],
Cell[100257, 2338, 2686, 60, 348, "Input",ExpressionUUID->"3f6436c5-7742-4f22-abac-f275a25df8ba"]
}, Open  ]],
Cell[CellGroupData[{
Cell[102980, 2403, 312, 5, 65, "Subsection",ExpressionUUID->"011b7a48-4fdb-4ab4-b782-936acb2d7572"],
Cell[103295, 2410, 2655, 66, 420, "Input",ExpressionUUID->"7fd55ef0-d854-4667-aa3e-498efc44223c"]
}, Open  ]],
Cell[CellGroupData[{
Cell[105987, 2481, 326, 5, 65, "Subsection",ExpressionUUID->"1b930816-87f0-4ec9-b8a2-c5ebecfef6bc"],
Cell[106316, 2488, 980, 19, 80, "Input",ExpressionUUID->"d7d9df58-06c9-4e25-bb7f-487a2db5dac0",
 InitializationCell->True],
Cell[107299, 2509, 3298, 68, 588, "Input",ExpressionUUID->"dbd61753-a3ab-4356-92e7-c06465ed0ff2"],
Cell[110600, 2579, 200, 3, 35, "Input",ExpressionUUID->"781c4bf4-04cb-4479-8173-9d7751ef7cbd"]
}, Open  ]],
Cell[CellGroupData[{
Cell[110837, 2587, 690, 10, 65, "Subsection",ExpressionUUID->"062f0d0a-adb1-45f6-8510-aa935961f160"],
Cell[111530, 2599, 2671, 62, 951, "Input",ExpressionUUID->"37db3755-6320-4b6e-b85a-0ab0220cbd6d"]
}, Open  ]]
}, Open  ]]
}
]
*)

